<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-02-01">

<title>Visual Analytics and Application - Take-home Exercise 4: Prototyping Modules for Shiny Application</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Images/Icon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../Images/Logo.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Hands-on Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html" rel="" target="">
 <span class="dropdown-text">1. A Layered Grammar of Graphics - ggplot2 methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02.html" rel="" target="">
 <span class="dropdown-text">2. Beyond ggplot2 Fundamentals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03.html" rel="" target="">
 <span class="dropdown-text">3a. Programming Interactive Data Visualisation with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03b.html" rel="" target="">
 <span class="dropdown-text">3b. Programming Animated Statistical Graphics with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04a.html" rel="" target="">
 <span class="dropdown-text">4a. Visualising Distribution</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04b.html" rel="" target="">
 <span class="dropdown-text">4b. Visualising Statistical Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04c.html" rel="" target="">
 <span class="dropdown-text">4c. Visualising Uncertainty</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04d.html" rel="" target="">
 <span class="dropdown-text">4d. Bulding Funnel Plot</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05a.html" rel="" target="">
 <span class="dropdown-text">5a. Building Ternary Plot with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05b.html" rel="" target="">
 <span class="dropdown-text">5b. Visual Correlation Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05c.html" rel="" target="">
 <span class="dropdown-text">5c. Visual Multivariate Analysis with Heatmap</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05d.html" rel="" target="">
 <span class="dropdown-text">5d. Visual Multivariate Analysis with Parallel Coordinates Plot</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05e.html" rel="" target="">
 <span class="dropdown-text">5e. Treemap Visualisation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html" rel="" target="">
 <span class="dropdown-text">6. Visualising and Analysing Time-oriented Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07a.html" rel="" target="">
 <span class="dropdown-text">7a. Choropleth Mapping, Geospatial Point Data, and Analytical Mapping</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07b.html" rel="" target="">
 <span class="dropdown-text">7b. Visualising Geospatial Point Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07c.html" rel="" target="">
 <span class="dropdown-text">7c. Analytical Mapping</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08.html" rel="" target="">
 <span class="dropdown-text">8. Modelling, Visualising and Analysing Network Data with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex09.html" rel="" target="">
 <span class="dropdown-text">9. Visualising and Analysing Text Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex10.html" rel="" target="">
 <span class="dropdown-text">10. Information Dashboard Design - R methods</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">In-class Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex01/In-class_Ex01.html" rel="" target="">
 <span class="dropdown-text">1. Now You See It</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex06/In-class_Ex06.html" rel="" target="">
 <span class="dropdown-text">2. Horizon Plot</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Take-home Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../Take-Home_Ex/Take-Home_Ex01/Take-Home_Ex01.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 1 - Investigating Student Performance</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-Home_Ex/Take-Home_Ex02/Take-Home_Ex02.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 2 - DataVis Makeover</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-Home_Ex/Take-Home_Ex03/Take-Home_Ex03.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 3 - Be Weatherwise or Otherwise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-Home_Ex/Take-Home_Ex4/Take-Home_Ex4.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 4</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li class="dropdown-header">Coming soon!</li>
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text"><i class="fa-solid fa-house fa-lg" aria-label="house"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text"><i class="fa-solid fa-paw fa-lg" aria-label="paw"></i></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">1 Overview</a></li>
  <li><a href="#loading-data-and-packages" id="toc-loading-data-and-packages" class="nav-link" data-scroll-target="#loading-data-and-packages">2 Loading Data and Packages</a>
  <ul>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">2.1 Packages</a></li>
  <li><a href="#the-pisa-survey-students-questionnaire" id="toc-the-pisa-survey-students-questionnaire" class="nav-link" data-scroll-target="#the-pisa-survey-students-questionnaire">2.2 The PISA Survey Students Questionnaire</a></li>
  </ul></li>
  <li><a href="#storyboard" id="toc-storyboard" class="nav-link" data-scroll-target="#storyboard">3 Storyboard</a>
  <ul>
  <li><a href="#draft-designs" id="toc-draft-designs" class="nav-link" data-scroll-target="#draft-designs">3.1 Draft Designs</a></li>
  <li><a href="#visual-model-diagnostic" id="toc-visual-model-diagnostic" class="nav-link" data-scroll-target="#visual-model-diagnostic">3.2 Visual Model Diagnostic</a></li>
  <li><a href="#statistical-model-evaluation" id="toc-statistical-model-evaluation" class="nav-link" data-scroll-target="#statistical-model-evaluation">3.3 Statistical Model Evaluation</a></li>
  </ul></li>
  <li><a href="#prelude" id="toc-prelude" class="nav-link" data-scroll-target="#prelude">4 Prelude</a>
  <ul>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">4.1 Data Preparation</a></li>
  </ul></li>
  <li><a href="#decision-tree" id="toc-decision-tree" class="nav-link" data-scroll-target="#decision-tree">5 Decision Tree</a>
  <ul>
  <li><a href="#the-models-first-run" id="toc-the-models-first-run" class="nav-link" data-scroll-target="#the-models-first-run">5.1 The Model’s First Run</a></li>
  <li><a href="#visual-model-diagnostics" id="toc-visual-model-diagnostics" class="nav-link" data-scroll-target="#visual-model-diagnostics">5.2 Visual Model Diagnostics</a></li>
  <li><a href="#statistical-model-evaluation-1" id="toc-statistical-model-evaluation-1" class="nav-link" data-scroll-target="#statistical-model-evaluation-1">5.3 Statistical Model Evaluation</a></li>
  <li><a href="#parameter-tuning" id="toc-parameter-tuning" class="nav-link" data-scroll-target="#parameter-tuning">5.4 Parameter Tuning</a>
  <ul class="collapse">
  <li><a href="#complexity-parameter" id="toc-complexity-parameter" class="nav-link" data-scroll-target="#complexity-parameter">5.4.1 Complexity Parameter</a></li>
  <li><a href="#refreshing-results" id="toc-refreshing-results" class="nav-link" data-scroll-target="#refreshing-results">5.4.2 Refreshing Results</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest">6 Random Forest</a>
  <ul>
  <li><a href="#the-model" id="toc-the-model" class="nav-link" data-scroll-target="#the-model">6.1 The Model</a></li>
  <li><a href="#visual-model-diagnostic-1" id="toc-visual-model-diagnostic-1" class="nav-link" data-scroll-target="#visual-model-diagnostic-1">6.2 Visual Model Diagnostic</a></li>
  <li><a href="#statistical-model-evaluation-2" id="toc-statistical-model-evaluation-2" class="nav-link" data-scroll-target="#statistical-model-evaluation-2">6.3 Statistical Model Evaluation</a></li>
  <li><a href="#variable-importance" id="toc-variable-importance" class="nav-link" data-scroll-target="#variable-importance">6.4 Variable Importance</a></li>
  </ul></li>
  <li><a href="#gradient-boosting" id="toc-gradient-boosting" class="nav-link" data-scroll-target="#gradient-boosting">7 Gradient Boosting</a>
  <ul>
  <li><a href="#the-model-1" id="toc-the-model-1" class="nav-link" data-scroll-target="#the-model-1">7.1 The Model</a></li>
  <li><a href="#visual-model-diagnostic-2" id="toc-visual-model-diagnostic-2" class="nav-link" data-scroll-target="#visual-model-diagnostic-2">7.2 Visual Model Diagnostic</a></li>
  <li><a href="#statistical-model-evaluation-3" id="toc-statistical-model-evaluation-3" class="nav-link" data-scroll-target="#statistical-model-evaluation-3">7.3 Statistical Model Evaluation</a></li>
  <li><a href="#variable-importance-1" id="toc-variable-importance-1" class="nav-link" data-scroll-target="#variable-importance-1">7.4 Variable Importance</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 4: Prototyping Modules for Shiny Application</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 1, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">March 10, 2024</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="overview" class="level1">
<h1>1 Overview</h1>
<p>International large-scale assessments, such as PISA, provide structured and static data. With the goal of exploring which factors have a higher relevance in predicting student performance, this post proposes the use of multiple linear regression and random forest approach to detect and analyse factors linked to academic performance.</p>
<p>Specifically, this post details the steps, packages, prototypes, including the detailed breakdown of codes used for UI and Server in R Shiny as part of the model building module in preparation for the final Shiny app.</p>
</section>
<section id="loading-data-and-packages" class="level1">
<h1>2 Loading Data and Packages</h1>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">2.1 Packages</h2>
<p>The packages used as part of this exercise includes:</p>
<table class="table">
<thead>
<tr class="header">
<th>Package</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://www.tidyverse.org/"><strong>tidyverse</strong></a></td>
<td>For data wrangling</td>
</tr>
<tr class="even">
<td><a href="https://ggplot2.tidyverse.org/"><strong>ggplot2</strong></a><strong>, <a href="https://patchwork.data-imaginist.com/">patchwork</a>, urbnthemes</strong></td>
<td>For plots and setting a consistent theme throughout this exercise.</td>
</tr>
<tr class="odd">
<td><a href="https://rstudio.github.io/htmltools/"><strong>htmltools</strong></a><strong>, <a href="https://glin.github.io/reactable/">reactable</a>, <a href="https://www.danieldsjoberg.com/gtsummary/">gtsummary</a></strong></td>
<td>For dynamic and static data tables</td>
</tr>
<tr class="even">
<td><a href="https://github.com/taiyun/corrplot"><strong>corrplot</strong></a></td>
<td>For correlation matrix</td>
</tr>
<tr class="odd">
<td><a href="https://topepo.github.io/caret/"><strong>caret</strong></a><strong>, <a href="https://www.tidymodels.org/">tidymodels</a></strong></td>
<td>For packages relating to modeling, regression, and machine learning</td>
</tr>
<tr class="even">
<td><a href="https://easystats.github.io/performance/"><strong>performance</strong></a></td>
<td>For assessment of regression models performance</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>               ggplot2, patchwork, urbnthemes, </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               gtsummary,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>               ranger, rpart.plot, caret, tidymodels, gbm, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>               performance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-pisa-survey-students-questionnaire" class="level2">
<h2 class="anchored" data-anchor-id="the-pisa-survey-students-questionnaire">2.2 The PISA Survey Students Questionnaire</h2>
<p>The code chunk below loads our dataset into R environment, in the form of a csv file created following minor data cleaning and wrangling documented <a href="https://projectpisa.netlify.app/phase1/dataprep">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>stu <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/stu_SG_rcd.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 6,606
Columns: 25
$ Loneliness         &lt;chr&gt; "Disagree", "Disagree", "Disagree", NA, "Strongly D…
$ ClassroomSafety    &lt;chr&gt; "Agree", "Strongly Agree", "Agree", "Agree", "Stron…
$ TeacherSupport     &lt;chr&gt; "Most lesson", "Most lesson", "Most lesson", "Most …
$ Gender             &lt;chr&gt; "Female", "Male", "Male", "Male", "Female", "Female…
$ Homework_Math      &lt;chr&gt; "≤ 0.5hr", "1hr - 2hr", "0.5hr - 1hr", "1hr - 2hr",…
$ Homework_Reading   &lt;chr&gt; "≤ 0.5hr", "0.5hr - 1hr", "1hr - 2hr", "≤ 0.5hr", "…
$ Homework_Science   &lt;chr&gt; "0.5hr - 1hr", "1hr - 2hr", "1hr - 2hr", "0.5hr - 1…
$ SchoolType         &lt;chr&gt; "Public", "Public", "Public", "Public", "Public", "…
$ ParentsEducation   &lt;chr&gt; "Tertiary", "Post-Secondary", "Secondary", "Post-Se…
$ Immigration        &lt;chr&gt; "Native", "Native", "Native", "Native", "Native", "…
$ HomeLanguage       &lt;chr&gt; "English", "English", "Others", "Others", "English"…
$ Sibling            &lt;chr&gt; "≥3", "≥3", "1", "≥3", "≥3", "2", "1", "1", "2", "≥…
$ Aircon             &lt;chr&gt; "No", "Yes", "Yes", "No", "No", "Yes", "Yes", "Yes"…
$ Helper             &lt;chr&gt; "No", "Yes", "No", "No", "No", "No", "No", "No", "Y…
$ Vehicle            &lt;chr&gt; "1", "0", "1", "0", "1", "1", "1", "0", "2", "2", "…
$ Books              &lt;chr&gt; "&gt;500", "26 - 100", "26 - 100", "11 - 25", "1 - 10"…
$ Exercise           &lt;dbl&gt; 1, 4, 2, 5, 9, 1, 2, 0, 3, 5, 1, 2, 5, 2, 4, 0, 2, …
$ OwnRoom            &lt;chr&gt; "No", "Yes", "Yes", "No", "No", "No", "Yes", "Yes",…
$ FamilyCommitment   &lt;dbl&gt; 10, 2, 0, 10, 5, 5, 7, 0, 0, 4, 2, 2, 10, 0, 10, 0,…
$ Preference_Math    &lt;chr&gt; "Disagree", "Strongly Agree", "Agree", "Disagree", …
$ Preference_Reading &lt;chr&gt; "Agree", "Agree", "Disagree", "Agree", "Strongly Ag…
$ Preference_Science &lt;chr&gt; "Agree", "Agree", "Agree", "Agree", "Strongly Agree…
$ Math               &lt;dbl&gt; 605.2533, 689.9528, 676.7768, 401.0528, 436.1151, 5…
$ Reading            &lt;dbl&gt; 667.4296, 627.6078, 582.9252, 361.3969, 475.6763, 4…
$ Science            &lt;dbl&gt; 639.7873, 672.0703, 660.0384, 343.6425, 479.2390, 4…</code></pre>
</div>
</div>
</section>
</section>
<section id="storyboard" class="level1">
<h1>3 Storyboard</h1>
<p>The flowchart below details the features for this model building module.</p>
<div class="cell" data-fig-width="8">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    C[Building Predictive Model]-.-&gt;C1[Decision Tree]
    C-.-&gt; C2[Random Forest]
    C-.-&gt; C3[Gradient Boosting]
    C1-.-&gt;F[3. Visual Model Diagnostics]
    C2-.-&gt;F
    F --&gt;E[4. Statistical Model Evaluation]
    E--&gt;D[5. Variable Importance]
</pre>
</div>
</div>
</div>
</div>
<section id="draft-designs" class="level2">
<h2 class="anchored" data-anchor-id="draft-designs">3.1 Draft Designs</h2>
<p>At the initial stage of the model building module, users would be able customise various options for building 3 predictive models. We perform a detailed walkthrough of the interactivity and customisation features, including descriptions of the SHINY UI and Server in Sections 5-7.</p>
<p>In the subsequent parts of this section, we briefly outline the rationale behind visualisations and measurements.</p>
</section>
<section id="visual-model-diagnostic" class="level2">
<h2 class="anchored" data-anchor-id="visual-model-diagnostic">3.2 Visual Model Diagnostic</h2>
<p>After training the models, we can use it to predict scores for the test data we held back using <code>predict()</code>. Then we can compare these predictions to the actual values to evaluate how well (or not) the models are working. We can get a better indication by visualising a scatter plot that compares the predictions to the actual scores and residuals.</p>
<ol type="1">
<li><p><strong>Predicted vs Actual:</strong> This is a scatter plot that helps you visualise the performance of a regression model. The x-axis represents the actual values, and the y-axis represents the predicted values. Ideally, if the predictions are perfect, the points will lie along a straight line with a slope of 1. We’ll also overlay a trend line to get a general sense for how well the predicted values align with the true values.</p></li>
<li><p><strong>Residuals vs Actual:</strong> A scatter plot of residuals (vertical axis) in function of the observed (horizontal axis) values of the dependent variable. For a “perfect” predictive model, we would expect the horizontal line at zero. For a “good” model, we would like to see a symmetric scatter of points around the horizontal line at zero, indicating random deviations of predictions from the observed values.</p></li>
</ol>
</section>
<section id="statistical-model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="statistical-model-evaluation">3.3 Statistical Model Evaluation</h2>
<p>We can quantify the residuals by calculating a number of commonly used evaluation metrics, with a focus on the following:</p>
<ul>
<li><p>Root Mean Square Error (RMSE): The square root of the MSE. This yields an absolute metric in the same unit as the response variable (in this case, scores). The smaller the value, the better the model (in a simplistic sense, it represents the average scores by which the predictions are wrong).</p></li>
<li><p><span class="math inline">\(R^2\)</span>: describes the strength of a model fit. In essence, this metric represents how much of the variance between predicted and actual label values the model is able to explain. The regular <span class="math inline">\(R^2\)</span> is a biased estimate of the amount of variability explained by the model when applied to model with more than one predictor. To get a better estimate, we use the <span class="math inline">\(adjusted\ R^2\)</span>. The best fit is the one that maximises <span class="math inline">\(R^2\)</span> or <span class="math inline">\(adjusted\ R^2\)</span>.</p></li>
<li><p>Mean Absolute Error (MAE): It is measured as the average absolute difference between the predicted values and the actual values and is used to assess the effectiveness of a regression model.</p></li>
</ul>
<p><code>formals()</code> function returns the argument list of the function specified. This can be used in the sidebar to display the options for user selection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">eval</span>(<span class="fu">formals</span>(cor)<span class="sc">$</span>method)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "pearson"  "kendall"  "spearman"</code></pre>
</div>
</div>
</section>
</section>
<section id="prelude" class="level1">
<h1>4 Prelude</h1>
<p>The general outline of a predictive analysis is as follows:</p>
<ul>
<li>Test-train split the available data using <code>createDataPartition()</code></li>
<li>Specify possible tuning parameters for method using <code>expand.grid()</code></li>
<li>Use resampling to find the “best model” by choosing the values of the tuning parameters
<ul>
<li><code>trainControl()</code> will specify the resampling scheme</li>
<li><code>train()</code> is the workhorse of caret. It takes the following information then trains (tunes) the requested model:
<ul>
<li><code>form</code>, a formula, such as <code>y ~ .</code>
<ul>
<li>This specifies the response and which predictors (or transformations of) should be used.</li>
</ul></li>
<li><code>data</code>, the data used for training</li>
<li><code>trControl</code> which specifies the resampling scheme, that is, how cross-validation should be performed to find the best values of the tuning parameters</li>
<li><code>preProcess</code> which allows for specification of data pre-processing such as centering and scaling</li>
<li><code>method</code>, a statistical learning method from a long list of availible models</li>
</ul></li>
<li><code>tuneGrid</code> which specifies the tuning parameters to train over</li>
</ul></li>
<li>Use chosen model to make predictions using <code>predict()</code></li>
</ul>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">4.1 Data Preparation</h2>
<p>The goal of training the model is to find a function that performs some kind of calculation to the <span class="math inline">\(x\)</span> values (i.e.&nbsp;independent variables) that produces the result <span class="math inline">\(y\)</span> (i.e.&nbsp;dependent variable). We do this by applying a machine learning algorithm that tries to fit the <span class="math inline">\(x\)</span> values to a calculation that produces <span class="math inline">\(y\)</span> reasonably accurately for all of the cases in the training dataset.</p>
<p>To train the model, we start with a data sample containing the independent/explanatory variables as well as known values for the subject scores. We’ll then split this data sample into two subsets:</p>
<ul>
<li><p>A <em>training</em> dataset to which we’ll apply an algorithm that determines a function encapsulating the relationship between the independent variables and the known <span class="math inline">\(y\)</span> values.</p></li>
<li><p>A <em>test</em> dataset that we can use to evaluate the model by using it to generate predictions for the label and comparing them to the actual known <span class="math inline">\(y\)</span> values.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Data for Model Building ##</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove missing cases &amp; convert variables to factor datatype our dataset</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>stu <span class="ot">&lt;-</span> stu <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>, as.factor))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> stu <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>, <span class="st">"Math"</span>)) <span class="co">#&lt;&lt; input$var, input$bm_target to change according to user selection</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the seed before splitting the data</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and test</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(data<span class="sc">$</span>Math, <span class="co">#&lt;&lt; input$bm_target</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">p =</span> <span class="fl">0.8</span>, <span class="co">#&lt;&lt; input$rf_partition</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">list =</span> <span class="cn">FALSE</span>) </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>traindata <span class="ot">&lt;-</span> data[index, ]</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>testdata  <span class="ot">&lt;-</span> data[<span class="sc">-</span>index, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<table class="table">
<thead>
<tr class="header">
<th>Function/Object</th>
<th>Feature</th>
<th>UI</th>
<th>Server</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><em>data</em></strong> <strong>for model building</strong></td>
<td>Select subject</td>
<td><p>Within <strong><em>sidebarPanel</em></strong>():</p>
<p>selectInput(<br>
inputId = “mb_target”,<br>
label = “Subject”,<br>
choices = c(“Math”, “Reading”, “Science”)</p></td>
<td>mb_data &lt;- eventReactive(input$mb_action,<br>
{stu %&gt;%<br>
select(input$mb_vars | mb_target)})</td>
</tr>
<tr class="even">
<td></td>
<td>Checkbox for variable selection; <a href="https://rstudio.github.io/sortable/"><strong>sortable</strong></a> package allows drag-and-drop to order variables</td>
<td><p>Within <strong><em>sidebarPanel</em></strong>():</p>
<p><a href="https://yang-tang.github.io/shinyjqui/reference/sortableCheckboxGroupInput.html"><strong><em>sortableCheckboxGroupInput</em></strong></a>(<br>
inputId = “mb_vars”,<br>
label = “Variables to show:”,<br>
choices = colnames(<em>stu</em>[,1:22]),<br>
selected = input$variables<br>
)</p></td>
<td>mb_data &lt;- eventReactive(input$mb_action,<br>
{stu %&gt;%<br>
select(input$mb_vars | mb_target)})</td>
</tr>
<tr class="odd">
<td></td>
<td>Select partition size</td>
<td>Within <strong><em>mainPanel</em></strong>() &gt; tabsetPanel() &gt; <strong><em>sliderInput</em></strong>(<br>
inputId = “mb_partition”,<br>
label = “Train-Test Partition Ratio:”,<br>
min = 0.5,<br>
max = 0.95,<br>
value = c(0.8)))</td>
<td><p>mb_index &lt;- eventReactive(<br>
input$mb_action, {<br>
createDataPartition(<br>
data()<em>[, input$mb_target]</em>,<br>
p = input$mb_partition,<br>
list = FALSE)<br>
})</p>
<p>mb_traindata &lt;- eventReactive(<br>
input$mb_action, {<br>
data()[mb_index(),]<br>
})</p>
<p>mb_testdata &lt;- eventReactive(<br>
input$mb_action, {<br>
mb_dataset()[-mb_index(),]<br>
})</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="decision-tree" class="level1">
<h1>5 Decision Tree</h1>
<section id="the-models-first-run" class="level2">
<h2 class="anchored" data-anchor-id="the-models-first-run">5.1 The Model’s First Run</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Specifying training choices ##</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Resampling Options</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>dt_fitcontrol <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="co"># input$dt_resamplingmethod</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">number =</span> <span class="dv">10</span>, <span class="co"># input$dt_resamplecnt</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">repeats =</span> <span class="cn">NA</span>) <span class="co"># input$dt_repeats</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>method</code>: Refers to the resampling method, such as <code>boot</code>, <code>cv</code> (cross validation), <code>repeatedcv</code></li>
<li><code>number</code>: <em>K-fold</em>, the number of times resampling should be done for methods that require resample eg <code>cv</code> and <code>boost</code></li>
<li><code>repeats</code>: Applies only to repeated <em>K-fold</em> cross-validation. Suppose that <code>method = "repeatedcv"</code>, <code>number = 10</code> and <code>repeats = 3</code>, then three separate 10-fold cross-validations are used as the resampling scheme.</li>
</ul>
<p>The decision tree has two adjustable parameters: complexity parameter (<em>CP</em>) and tune length (<em>TL</em>). CP tells the algorithm to stop when the measure does not improve by this factor. TL tells how many instances to use for training. I’ll let the model look for the best CP tuning parameter with <code>tuneLength</code> to get close using the initial model, then fine-tune with <code>tuneGrid</code> at a later stage.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>dtmodel <span class="ot">&lt;-</span> <span class="fu">train</span>(Math <span class="sc">~</span> ., </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> traindata,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"rpart"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">tuneLength =</span> <span class="dv">4</span>, <span class="co">#input$dt_tunelength</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trControl =</span> dt_fitcontrol</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>dtmodel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CART 

4128 samples
  22 predictor

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 3716, 3715, 3715, 3715, 3714, 3715, ... 
Resampling results across tuning parameters:

  cp          RMSE      Rsquared    MAE     
  0.01850079  93.47881  0.10840404  75.55322
  0.02168293  94.03535  0.09713273  76.17916
  0.02170645  94.03535  0.09713273  76.17916
  0.07902291  97.76751  0.05523462  79.69776

RMSE was used to select the optimal model using the smallest value.
The final value used for the model was cp = 0.01850079.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(dtmodel<span class="sc">$</span>finalModel,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">box.palette=</span><span class="st">"GnBu"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">branch.lty=</span><span class="dv">3</span>, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">shadow.col=</span><span class="st">"gray"</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">nn=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The boxes show the node predicted value (mean) and the proportion of observations that are in the node (or child nodes).</p>
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 20%">
<col style="width: 35%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Feature</th>
<th>UI</th>
<th>Server</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>trainControl()</strong></td>
<td>Select resampling method, resampling count and repeat.</td>
<td><p>numericInput(inputId = “dt_cvkfold_number”,<br>
label = “K-fold:”,<br>
min = 3,<br>
max = 50,<br>
value = 10))),</p>
<p>numericInput(inputId = “dt_repeatkfold_number”,<br>
label = “K-fold:”,<br>
min = 3,<br>
max = 50,<br>
value = 10))),</p>
<p>numericInput(inputId = “dt_repeatkfold_repeat”, label = “Number of Repeats:”,<br>
min = 3,<br>
max = 10,<br>
value = 3))),</p></td>
<td><p>Within <strong><em>mainPanel</em></strong>() &gt; tabsetPanel() &gt;<br>
</p>
<p><u>For Cross Validation</u><br>
dt_resamplecv_kfoldnum &lt;- eventReactive(input$mb_action, {<br>
trainControl(<br>
method = “cv”,<br>
number = input$dt_cvkfold_number)<br>
})</p>
<p><u>For Repeated Cross Validation<br>
</u>dt_resamplercv_kfoldnum &lt;- eventReactive(input$mb_action, {<br>
trainControl(<br>
method = “cv”,<br>
number = input$dt_repeatkfold_number)<br>
})</p>
<p>dt_repeatnum &lt;- eventReactive(<br>
input$mb_action, {<br>
trainControl(<br>
method = “repeatedcv”,<br>
number = input$dt_repeatkfold_number,<br>
repeats = input$dt_repeatkfold_repeat)<br>
})</p></td>
</tr>
<tr class="even">
<td><strong>train()</strong></td>
<td>Set initial tune length</td>
<td>numericInput(inputId = “dt_tunelength”, label = “Set Initial Tune Length:”,<br>
min = 2,<br>
max = 10,<br>
value = 4))),</td>
<td>dtmodel &lt;- eventReactive(<br>
train(Math ~ .,<br>
data = mb_traindata,<br>
method = “rpart”,<br>
tuneLength = input$dt_tunelength<br>
trControl = dt_fitcontrol<br>
)</td>
</tr>
<tr class="odd">
<td><strong>rpart.plotO</strong></td>
<td>Show plots when selections are completed and ‘Build Model’ option is triggered.</td>
<td>plotOutput(“dt_rpartplot”)</td>
<td>dt_rpartplot &lt;- eventReactive(<br>
input$mb_action, {<br>
<em>rpart.plot()<br>
</em>})<br>
<br>
output$dt_rpartplot &lt;-<br>
renderPlot({<br>
dt_rpartplot<br>
})</td>
</tr>
</tbody>
</table>
</section>
<section id="visual-model-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="visual-model-diagnostics">5.2 Visual Model Diagnostics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>predict_dt <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">Actual =</span> testdata<span class="sc">$</span>Math, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">Predicted =</span> <span class="fu">predict</span>(dtmodel, <span class="at">newdata =</span> testdata),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">Residuals =</span> <span class="fu">predict</span>(dtmodel, <span class="at">newdata =</span> testdata) <span class="sc">-</span> testdata<span class="sc">$</span>Math</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dt_predvsactual <span class="ot">&lt;-</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="at">data =</span> predict_dt,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">x =</span> Actual, <span class="at">y =</span> Predicted)) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, <span class="at">color=</span><span class="st">"#dfb2e9"</span>) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#20948b"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predicted vs Actual"</span>) <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">plot.background=</span><span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">"#f5f5f5"</span>,<span class="at">colour=</span><span class="st">"#f5f5f5"</span>))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>dt_residvsactual <span class="ot">&lt;-</span> </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="at">data =</span> predict_dt,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">x =</span> Actual, <span class="at">y =</span> Residuals)) <span class="sc">+</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, <span class="at">color=</span><span class="st">"#dfb2e9"</span>) <span class="sc">+</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#20948b"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residuals vs Predicted"</span>) <span class="sc">+</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">plot.background=</span><span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">"#f5f5f5"</span>,<span class="at">colour=</span><span class="st">"#f5f5f5"</span>))</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>dt_predvsactual <span class="sc">+</span> dt_residvsactual <span class="sc">+</span> </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 20%">
<col style="width: 35%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Feature</th>
<th>UI</th>
<th>Server</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>predict()</strong></td>
<td>Option to allow users to choose if they want to visualise results using train or test data.<br>
<br>
Predict data when selections are completed and ‘Build Model’ option is triggered.</td>
<td>radioButtons(<br>
inputId = “traintest”,<br>
label = “Display Results Using:”,<br>
choices = c(“Train”, “Test”),<br>
selected = “Test”))</td>
<td>predictdt_model &lt;- eventReactive(<br>
<em>input$mb_action</em>, {<br>
predict(<em>dtmodel()</em>,<br>
newdata = if (input$<em>traintest</em> == “Test”, { <em>testdata()</em> }<em>,<br>
else { traindata() }</em>)<br>
})</td>
</tr>
<tr class="even">
<td><strong>bind_cols</strong></td>
<td>Creating a new dataframe containing actual, predicted, and residuals for visualisation.</td>
<td>-</td>
<td>predict_dt &lt;- eventReactive(<br>
input$mb_action, {<br>
Actual = <em>testdata()$input$mb_target</em>,<br>
Predicted = <em>predictdt_model()</em>,<br>
Residuals = <em>predictdt_model()</em> - <em>testdata()$input$mb_target</em>)<br>
})</td>
</tr>
<tr class="odd">
<td><strong>Diagnostic plots</strong></td>
<td>Refresh plots when selections are completed and ‘Build Model’ option is triggered.</td>
<td>tabbox() &gt; tabPanel() &gt;<br>
plotOutput(“dt_predvsactual_”)<br>
<br>
tabPanel() &gt;<br>
plotOutput(“dt_residvsactual_”)</td>
<td><p><u>Plot Predicted vs Actual<br>
</u>dt_predvsactual &lt;- eventReactive(<br>
input$bm_action, {<br>
<em>ggplot(…)<br>
</em>})<br>
<br>
output$dt_predvsactual_ &lt;-<br>
renderPlot({<br>
dt_predvsactual<br>
})</p>
<p><u>Plot Residuals vs Actual</u></p>
<p>dt_residvsactual &lt;- eventReactive(<br>
input$dt_action, {<br>
<em>ggplot(…)<br>
</em>})<br>
<br>
output$dt_residvsactual_ &lt;-<br>
renderPlot({<br>
dt_residvsactual})</p></td>
</tr>
</tbody>
</table>
</section>
<section id="statistical-model-evaluation-1" class="level2">
<h2 class="anchored" data-anchor-id="statistical-model-evaluation-1">5.3 Statistical Model Evaluation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>dt_rmse <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(<span class="at">pred =</span> predict_dt<span class="sc">$</span>Predicted, <span class="at">obs =</span> predict_dt<span class="sc">$</span>Actual)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>dt_rsq <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="at">pred =</span> predict_dt<span class="sc">$</span>Predicted, <span class="at">obs =</span> predict_dt<span class="sc">$</span>Actual)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>dt_mae <span class="ot">&lt;-</span> <span class="fu">MAE</span>(<span class="at">pred =</span> predict_dt<span class="sc">$</span>Predicted, <span class="at">obs =</span> predict_dt<span class="sc">$</span>Actual)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>dt_rmse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 90.52466</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dt_rsq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1319645</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dt_mae</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 73.3128</code></pre>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 47%">
<col style="width: 18%">
<col style="width: 26%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Function</strong></td>
<td><strong>Function</strong></td>
<td><strong>UI</strong></td>
<td><strong>Server</strong></td>
</tr>
<tr class="even">
<td><strong>predict()</strong></td>
<td>Test data results to be updated when response and explanatory variables are selected and ‘Build Model’ is clicked.</td>
<td></td>
<td><p><u>Calculate RMSE</u></p>
<p>predict_dt &lt;- eventReactive(<br>
input$bm_action, {<br>
bind_cols(<br>
Actual = stu_test_rf<em>()$input$bm_target</em>,<br>
Predicted = predict(<em>stu_rf()</em>,<br>
newdata = <em>stu_test_rf()</em>), Residuals = predict(<em>stu_rf()</em>,<br>
newdata = <em>stu_test_rf()</em> - <em>stu_test_rf()$input$bm_target</em>)<br>
})</p>
<p>predict_rf_rmse &lt;- eventReactive(<br>
input$mb_action, { caret::RMSE(<br>
pred = <em>predict_dt()$Predicted</em>,<br>
obs = <em>predict_dt()$Actual</em>)<br>
})</p></td>
</tr>
<tr class="odd">
<td><strong>RMSE()</strong></td>
<td>Metrics displayed to be updated when response and explanatory variables are selected and ‘Build Model’ is clicked.</td>
<td><p>Within mainPanel():</p>
<p>fluidRow( div(<br>
<strong><em>valueBoxOutput</em></strong>(“dt_rmse”, width = 3))</p></td>
<td><p><u>Display results, eg RMSE</u></p>
<p>rf_display_RMSE = function(){<br>
output$dt_rmse = <strong><em>renderValueBox</em></strong>(<br>
valueBox(<br>
value = <em>predict_dt_rmse()</em>)<br>
)}</p>
<p>observeEvent(input$mb_action, <em>dt_display_RMSE()</em>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="parameter-tuning" class="level2">
<h2 class="anchored" data-anchor-id="parameter-tuning">5.4 Parameter Tuning</h2>
<section id="complexity-parameter" class="level3">
<h3 class="anchored" data-anchor-id="complexity-parameter">5.4.1 Complexity Parameter</h3>
<p>Upon receiving the results of our initial decision tree model, user can further refine the model based on the complexity parameter plot. Diagnosis plots, tree visualisation, statistical results should be updated based on the revised model.</p>
<p>To prune a tree, we want the cp value (with a simpler tree) that minimises the xerror.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dtmodel<span class="sc">$</span>bestTune</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          cp
1 0.01850079</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dt_cp_plot <span class="ot">&lt;-</span> <span class="fu">plot</span>(dtmodel)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>dt_cp_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 50%">
<col style="width: 17%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Feature</th>
<th>UI</th>
<th>Server</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>rpart.plotO</strong></td>
<td>Show plots when selections are completed and ‘Build Model’ option is triggered.</td>
<td>plotOutput(“dt_cp_plot_”)</td>
<td>dt_cp_plot&lt;- eventReactive(<br>
input$mb_action, {<br>
<em>plot(dtmodel())<br>
</em>})<br>
<br>
output$dt_cp_plot_&lt;-<br>
renderPlot({<br>
dt_cp_plot()<br>
})</td>
</tr>
</tbody>
</table>
</section>
<section id="refreshing-results" class="level3">
<h3 class="anchored" data-anchor-id="refreshing-results">5.4.2 Refreshing Results</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>dtmodel_pruned <span class="ot">&lt;-</span> <span class="fu">train</span>(Math <span class="sc">~</span> ., </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> traindata,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"rpart"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.01</span>, <span class="at">to =</span> <span class="fl">0.02</span>, <span class="at">by =</span> <span class="fl">0.001</span>)), <span class="co">#input$dt_cp</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trControl =</span> dt_fitcontrol</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(dtmodel_pruned<span class="sc">$</span>finalModel,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">box.palette=</span><span class="st">"GnBu"</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">branch.lty=</span><span class="dv">3</span>, </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">shadow.col=</span><span class="st">"gray"</span>, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">nn=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>predict_dtpruned <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">Actual =</span> testdata<span class="sc">$</span>Math, </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">Predicted =</span> <span class="fu">predict</span>(dtmodel_pruned, <span class="at">newdata =</span> testdata),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">Residuals =</span> <span class="fu">predict</span>(dtmodel_pruned, <span class="at">newdata =</span> testdata) <span class="sc">-</span> testdata<span class="sc">$</span>Math</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>dtpruned_rmse <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(<span class="at">pred =</span> predict_dtpruned<span class="sc">$</span>Predicted, <span class="at">obs =</span> predict_dtpruned<span class="sc">$</span>Actual)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>dtpruned_rsq <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="at">pred =</span> predict_dtpruned<span class="sc">$</span>Predicted, <span class="at">obs =</span> predict_dtpruned<span class="sc">$</span>Actual)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>dtpruned_mae <span class="ot">&lt;-</span> <span class="fu">MAE</span>(<span class="at">pred =</span> predict_dtpruned<span class="sc">$</span>Predicted, <span class="at">obs =</span> predict_dtpruned<span class="sc">$</span>Actual)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>dtpruned_rmse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 88.95871</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dtpruned_rsq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1620932</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dtpruned_mae</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 72.37935</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="random-forest" class="level1">
<h1>6 Random Forest</h1>
<section id="the-model" class="level2">
<h2 class="anchored" data-anchor-id="the-model">6.1 The Model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Specifying training choices ##</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Resampling Options</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>rf_fitcontrol <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="co"># input$rf_resamplingmethod</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">number =</span> <span class="dv">5</span>, <span class="co"># input$rf_resamplecnt</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">repeats =</span> <span class="cn">NA</span>)  <span class="co"># input$rf_repeats</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This model has 3 tuning parameters:</p>
<ul>
<li><code>mtry</code>: Randomly Selected Predictors (type: integer)</li>
<li><code>trees</code>: Trees (type: integer, default: 500L)</li>
<li><code>min_n</code>: Minimal Node Size (type: integer)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Model Parameters ##</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>tgrid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="fu">sqrt</span>(<span class="fu">ncol</span>(traindata)),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">splitrule =</span> <span class="st">"variance"</span>, <span class="co"># input$rf_splitrule: "variance", "extratrees", "maxstat" or "beta" with default "variance" for regression</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.node.size =</span> <span class="dv">5</span> <span class="co"># Default 5 for regression</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>rfmodel <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="at">form =</span> Math <span class="sc">~</span> .,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> traindata,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"ranger"</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trControl =</span> rf_fitcontrol,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">num.trees =</span> <span class="dv">50</span>, <span class="co"># input$treenum</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">importance =</span> <span class="st">"permutation"</span>, <span class="co"># input$rf_varimpmode: none, impurity, permutation</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">tuneGrid =</span> tgrid</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>rfmodel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest 

4128 samples
  22 predictor

No pre-processing
Resampling: Cross-Validated (5 fold) 
Summary of sample sizes: 3302, 3302, 3302, 3303, 3303 
Resampling results:

  RMSE     Rsquared  MAE     
  81.4222  0.363924  65.59421

Tuning parameter 'mtry' was held constant at a value of 4.795832

Tuning parameter 'splitrule' was held constant at a value of variance

Tuning parameter 'min.node.size' was held constant at a value of 5</code></pre>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 23%">
<col style="width: 33%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Feature</th>
<th>UI</th>
<th>Server</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>trainControl()</strong></td>
<td>Select resampling method, resampling count and repeat.</td>
<td><p>numericInput(inputId = “rf_cvkfold_number”,<br>
label = “K-fold:”,<br>
min = 3,<br>
max = 50,<br>
value = 10))),</p>
<p>numericInput(inputId = “rf_repeatkfold_number”,<br>
label = “K-fold:”,<br>
min = 3,<br>
max = 50,<br>
value = 10))),</p>
<p>numericInput(inputId = “rf_repeatkfold_repeat”, label = “Number of Repeats:”,<br>
min = 3,<br>
max = 10,<br>
value = 3))),</p></td>
<td><p>Within <strong><em>mainPanel</em></strong>() &gt; tabsetPanel() &gt;</p>
<p><u>For Cross Validation</u><br>
rf_resamplecv_kfoldnum &lt;- eventReactive(input$mb_action, {<br>
trainControl(<br>
method = “cv”,<br>
number = input$rf_cvkfold_number)<br>
})</p>
<p><u>For Repeated Cross Validation<br>
</u>rf_resamplercv_kfoldnum &lt;- eventReactive(input$mb_action, {<br>
trainControl(<br>
method = “cv”,<br>
number = input$rf_repeatkfold_number)<br>
})</p>
<p>rf_repeatnum &lt;- eventReactive(<br>
input$mb_action, {<br>
trainControl(<br>
method = “repeatedcv”,<br>
number = input$rf_repeatkfold_number,<br>
repeats = input$dt_repeatkfold_repeat)<br>
})</p></td>
</tr>
<tr class="even">
<td><strong>expand.grid()</strong></td>
<td>Select split rule</td>
<td>selectInput(inputId = “rf_splitrule_”,<br>
label = “Select Split Rule:”,<br>
choices = c(“Variance” = “variance”,<br>
“Extra Trees” = “extratrees”,<br>
“Max Stat” = “maxstat”)</td>
<td>tgrid &lt;- eventReaction(input$mb_action, {<br>
expand.grid(<br>
mtry = sqrt(ncol(traindata)),<br>
splitrule = “variance”.<br>
min.node.size = 5)}</td>
</tr>
<tr class="odd">
<td><strong>train()</strong></td>
<td>Select number of trees and variable importance</td>
<td><p>sliderInput(inputId = “rf_tree_range_”,<br>
label = “Range of Trees (keep range within 20):”,<br>
min = 5,<br>
max = 100,<br>
value = c(5,25)))</p>
<p>radioButtons(inputId = “rf_varimpmode_”,<br>
label = “Feature Importance:”,<br>
choices = c(“Gini Importance” = “impurity”,<br>
“Permutation Importance” = “permutation”),selected = “impurity”))</p></td>
<td>rfmodel &lt;- eventReactive(<br>
input$mb_action, {<br>
train(form = Math ~ .,<br>
data = traindata(),<br>
method = “ranger”,<br>
trControl = fitcontrol(),<br>
num.trees = <em>input$rf_tree_range,</em><br>
importance =<br>
<em>input$rf_varimpmode</em>,<br>
tuneGrid = <em>tgrid()</em>)<br>
})</td>
</tr>
</tbody>
</table>
</section>
<section id="visual-model-diagnostic-1" class="level2">
<h2 class="anchored" data-anchor-id="visual-model-diagnostic-1">6.2 Visual Model Diagnostic</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>rfmodel<span class="sc">$</span>bestTune</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      mtry splitrule min.node.size
1 4.795832  variance             5</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>predict_rf <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">Actual =</span> testdata<span class="sc">$</span>Math, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">Predicted =</span> <span class="fu">predict</span>(rfmodel, <span class="at">newdata =</span> testdata),</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">Residuals =</span> <span class="fu">predict</span>(rfmodel, <span class="at">newdata =</span> testdata) <span class="sc">-</span> testdata<span class="sc">$</span>Math</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>rf_predvsactual <span class="ot">&lt;-</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="at">data =</span> predict_rf,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">x =</span> Actual, <span class="at">y =</span> Predicted)) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, <span class="at">color=</span><span class="st">"#dfb2e9"</span>) <span class="sc">+</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#20948b"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predicted vs Actual"</span>) <span class="sc">+</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">plot.background=</span><span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">"#f5f5f5"</span>,<span class="at">colour=</span><span class="st">"#f5f5f5"</span>))</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>rf_residvsactual <span class="ot">&lt;-</span> </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="at">data =</span> predict_rf,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">x =</span> Actual, <span class="at">y =</span> Residuals)) <span class="sc">+</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, <span class="at">color=</span><span class="st">"#dfb2e9"</span>) <span class="sc">+</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#20948b"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residuals vs Predicted"</span>) <span class="sc">+</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">plot.background=</span><span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">"#f5f5f5"</span>,<span class="at">colour=</span><span class="st">"#f5f5f5"</span>))</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>rf_predvsactual <span class="sc">+</span> rf_residvsactual <span class="sc">+</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="statistical-model-evaluation-2" class="level2">
<h2 class="anchored" data-anchor-id="statistical-model-evaluation-2">6.3 Statistical Model Evaluation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>rf_rmse <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(<span class="at">pred =</span> predict_rf<span class="sc">$</span>Predicted, <span class="at">obs =</span> predict_rf<span class="sc">$</span>Actual)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>rf_rsq <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="at">pred =</span> predict_rf<span class="sc">$</span>Predicted, <span class="at">obs =</span> predict_rf<span class="sc">$</span>Actual)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>rf_mae <span class="ot">&lt;-</span> <span class="fu">MAE</span>(<span class="at">pred =</span> predict_rf<span class="sc">$</span>Predicted, <span class="at">obs =</span> predict_rf<span class="sc">$</span>Actual)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>rf_rmse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 80.13941</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>rf_rsq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3483527</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>rf_mae</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 64.93847</code></pre>
</div>
</div>
</section>
<section id="variable-importance" class="level2">
<h2 class="anchored" data-anchor-id="variable-importance">6.4 Variable Importance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">varImp</span>(rfmodel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#rf_varimp &lt;- importance(rfmodel) %&gt;% </span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  as.data.frame() %&gt;% </span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  rownames_to_column() %&gt;% </span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  rename("Variable" = rowname) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#bar_chart &lt;- function(label, width = "100%", height = "1rem", fill = "#73b2c4", background = "#f5f5f5") {</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  bar &lt;- div(style = list(background = fill, width = width, height = height))</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  chart &lt;- div(style = list(flexGrow = 1, marginLeft = "0.5rem", background = "#f5f5f5"), bar)</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  div(style = list(display = "flex", alignItems = "center"), label, chart)</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co">#tab_varimp &lt;- </span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  reactable(data = rf_varimp,</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">#         </span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co">#          columns = list(</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co">#            `%IncMSE` = colDef(</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co">#              name = "% Increase in Mean Square Error",</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co">#              align = 'left',</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co">#              cell = function (value) {</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                width &lt;- paste0(value, "%")</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                bar_chart(round(value,2), width = width)</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co">#              }),</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="co">#            IncNodePurity = colDef(</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co">#              name = "Increase in Node Purity",</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="co">#              align = 'left',</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="co">#              cell = function (value) {</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                width &lt;- paste0(value/ max(rf_varimp$IncNodePurity) *100, "%")</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="co">#                bar_chart(format(as.numeric(value), nsmall = 0, big.mark=","), width = width, fill = "#f27279", background = "#f5f5f5")</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="co">#              })            </span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a><span class="co">#          ))</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a><span class="co">#tab_varimp</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 20%">
<col style="width: 35%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Feature</th>
<th>UI</th>
<th>Server</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>rf_varimp &amp; <a href="https://glin.github.io/reactable/">reactable</a></strong></td>
<td>Plots to be updated when response and explanatory variables are selected and ‘Build Model’ is clicked.</td>
<td><p>Within <strong><em>sidebarPanel</em></strong>():</p>
<p>reactableOutput(“tab_varimp”)</p></td>
<td><p>rf_varimp &lt;- eventReactive(<br>
input$rf_action_, {<br>
importance(stu_rf) %&gt;% as.data.frame() %&gt;%<br>
rownames_to_column() %&gt;%<br>
rename(“Variable” = rowname)<br>
})</p>
<p>output$tab_varimp &lt;- renderReactable({<br>
reactable(…)<br>
})</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="gradient-boosting" class="level1">
<h1>7 Gradient Boosting</h1>
<section id="the-model-1" class="level2">
<h2 class="anchored" data-anchor-id="the-model-1">7.1 The Model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Specifying training choices ##</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Resampling Options</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>gb_fitcontrol <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="co"># input$gb_resamplingmethod - </span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">number =</span> <span class="dv">5</span>, <span class="co"># input$gb_resamplecnt</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">repeats =</span> <span class="cn">NA</span>) <span class="co"># input$gb_repeats</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Tuning Grid</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>gbm_grid <span class="ot">=</span> <span class="fu">expand.grid</span>(<span class="at">interaction.depth =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n.trees =</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>) <span class="sc">*</span> <span class="dv">10</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">shrinkage =</span> <span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>),</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n.minobsinnode =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>gbm</code> has the following tuneable hyperparameters:</p>
<ul>
<li><p><code>n.trees</code>: number of boosting iterations</p></li>
<li><p><code>nteraction.depth</code>: maximum tree depth</p></li>
<li><p><code>shrinkage</code>: the learning rate or shrinkage parameter - <code>n.minobsinnode</code>: minimum terminal node size</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>gbmodel <span class="ot">&lt;-</span> <span class="fu">train</span>(Math <span class="sc">~</span> .,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> traindata,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trControl =</span> gb_fitcontrol,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"gbm"</span>,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">tuneLength =</span> <span class="dv">5</span>,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">tuneGrid =</span> gbm_grid)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>gbmodel                 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Stochastic Gradient Boosting 

4128 samples
  22 predictor

No pre-processing
Resampling: Cross-Validated (5 fold) 
Summary of sample sizes: 3302, 3302, 3302, 3303, 3303 
Resampling results across tuning parameters:

  shrinkage  interaction.depth  n.trees  RMSE      Rsquared    MAE     
  0.01       1                   10      98.07437  0.08807327  80.10251
  0.01       1                   20      97.47337  0.09837644  79.60063
  0.01       1                   30      96.95464  0.11240227  79.15383
  0.01       1                   40      96.47760  0.12387731  78.74312
  0.01       1                   50      96.05209  0.12941446  78.37400
  0.01       1                   60      95.66458  0.13854867  78.03350
  0.01       1                   70      95.27882  0.14782104  77.70261
  0.01       1                   80      94.91735  0.15469400  77.40343
  0.01       1                   90      94.57435  0.16277897  77.10424
  0.01       1                  100      94.25871  0.17163798  76.83391
  0.01       1                  110      93.94660  0.17928220  76.56867
  0.01       1                  120      93.63760  0.18580648  76.31046
  0.01       1                  130      93.34836  0.19275638  76.06107
  0.01       1                  140      93.07684  0.19898002  75.82486
  0.01       1                  150      92.81228  0.20337459  75.58922
  0.01       1                  160      92.54999  0.20790547  75.37088
  0.01       1                  170      92.29821  0.21127670  75.15427
  0.01       1                  180      92.05088  0.21552821  74.94150
  0.01       1                  190      91.80570  0.21870589  74.72731
  0.01       1                  200      91.57332  0.22275672  74.52781
  0.01       1                  210      91.34174  0.22665841  74.33075
  0.01       1                  220      91.12777  0.23003506  74.14185
  0.01       1                  230      90.90290  0.23440175  73.96480
  0.01       1                  240      90.68914  0.23788453  73.78525
  0.01       1                  250      90.48454  0.24116808  73.61419
  0.01       1                  260      90.28870  0.24445253  73.44199
  0.01       1                  270      90.09323  0.24722753  73.26827
  0.01       1                  280      89.89734  0.25062649  73.10342
  0.01       1                  290      89.70812  0.25332527  72.94930
  0.01       1                  300      89.51855  0.25622314  72.78415
  0.01       2                   10      97.85408  0.12506935  79.92329
  0.01       2                   20      97.03806  0.13678664  79.24364
  0.01       2                   30      96.29675  0.15368410  78.61501
  0.01       2                   40      95.60733  0.16195956  78.01551
  0.01       2                   50      94.96305  0.17388729  77.45499
  0.01       2                   60      94.36754  0.18596794  76.93899
  0.01       2                   70      93.80114  0.19521061  76.44077
  0.01       2                   80      93.26322  0.20580554  75.97575
  0.01       2                   90      92.75095  0.21486261  75.53792
  0.01       2                  100      92.27297  0.22078182  75.11798
  0.01       2                  110      91.80668  0.22982514  74.72519
  0.01       2                  120      91.38660  0.23609634  74.36417
  0.01       2                  130      90.97806  0.24282204  74.01753
  0.01       2                  140      90.57978  0.24950864  73.67478
  0.01       2                  150      90.20610  0.25581321  73.35255
  0.01       2                  160      89.82500  0.26164640  73.02039
  0.01       2                  170      89.47598  0.26616059  72.72208
  0.01       2                  180      89.14603  0.27126257  72.43282
  0.01       2                  190      88.80890  0.27465231  72.14420
  0.01       2                  200      88.48956  0.27919360  71.87116
  0.01       2                  210      88.18930  0.28253957  71.60932
  0.01       2                  220      87.88918  0.28645385  71.34393
  0.01       2                  230      87.60511  0.28989493  71.08759
  0.01       2                  240      87.31776  0.29384077  70.83851
  0.01       2                  250      87.03824  0.29753661  70.59798
  0.01       2                  260      86.76807  0.30095767  70.35736
  0.01       2                  270      86.53175  0.30319152  70.14746
  0.01       2                  280      86.27476  0.30638862  69.93033
  0.01       2                  290      86.04242  0.30874301  69.73613
  0.01       2                  300      85.80870  0.31149532  69.53281
  0.01       3                   10      97.65289  0.14960096  79.74603
  0.01       3                   20      96.64265  0.16807110  78.89666
  0.01       3                   30      95.73026  0.18150324  78.11568
  0.01       3                   40      94.88177  0.19382676  77.39182
  0.01       3                   50      94.09136  0.20645447  76.70890
  0.01       3                   60      93.35374  0.21779972  76.08925
  0.01       3                   70      92.65442  0.22870970  75.48126
  0.01       3                   80      91.99956  0.23804060  74.91808
  0.01       3                   90      91.42811  0.24615966  74.41347
  0.01       3                  100      90.83450  0.25505722  73.91413
  0.01       3                  110      90.29643  0.26304858  73.45809
  0.01       3                  120      89.77997  0.26903502  73.00959
  0.01       3                  130      89.29077  0.27534481  72.58005
  0.01       3                  140      88.84377  0.28160966  72.18900
  0.01       3                  150      88.39183  0.28703274  71.78884
  0.01       3                  160      87.98785  0.29089402  71.43089
  0.01       3                  170      87.60693  0.29500983  71.10154
  0.01       3                  180      87.22942  0.29877495  70.76656
  0.01       3                  190      86.87568  0.30252972  70.46417
  0.01       3                  200      86.54159  0.30535605  70.17978
  0.01       3                  210      86.20927  0.30891773  69.89784
  0.01       3                  220      85.91032  0.31122926  69.63923
  0.01       3                  230      85.59678  0.31463461  69.37184
  0.01       3                  240      85.30758  0.31729579  69.11501
  0.01       3                  250      85.03869  0.32030848  68.87883
  0.01       3                  260      84.78236  0.32254791  68.64805
  0.01       3                  270      84.50046  0.32573321  68.41538
  0.01       3                  280      84.24296  0.32856029  68.19304
  0.01       3                  290      84.00417  0.33091240  67.98462
  0.01       3                  300      83.76684  0.33323781  67.78292
  0.05       1                   10      95.97882  0.13571032  78.32889
  0.05       1                   20      94.18100  0.16578059  76.75062
  0.05       1                   30      92.73170  0.20032480  75.52777
  0.05       1                   40      91.50834  0.22011376  74.46553
  0.05       1                   50      90.39323  0.24003429  73.50423
  0.05       1                   60      89.41020  0.25730554  72.67480
  0.05       1                   70      88.53850  0.26952613  71.93411
  0.05       1                   80      87.75038  0.27847170  71.22353
  0.05       1                   90      87.00229  0.28996618  70.57505
  0.05       1                  100      86.35322  0.29639436  69.99980
  0.05       1                  110      85.80306  0.30077372  69.53564
  0.05       1                  120      85.24639  0.30800467  69.02923
  0.05       1                  130      84.75909  0.31194020  68.59600
  0.05       1                  140      84.33724  0.31652272  68.21635
  0.05       1                  150      83.93929  0.31943121  67.85140
  0.05       1                  160      83.57027  0.32443001  67.50888
  0.05       1                  170      83.22041  0.32833700  67.18428
  0.05       1                  180      82.89057  0.33171106  66.89517
  0.05       1                  190      82.56585  0.33611445  66.63971
  0.05       1                  200      82.27697  0.33912891  66.36940
  0.05       1                  210      82.00223  0.34253855  66.13702
  0.05       1                  220      81.73293  0.34646780  65.90660
  0.05       1                  230      81.45004  0.35020681  65.65595
  0.05       1                  240      81.24370  0.35221571  65.46808
  0.05       1                  250      81.00020  0.35500218  65.25591
  0.05       1                  260      80.77792  0.35717237  65.06977
  0.05       1                  270      80.56683  0.35985758  64.87200
  0.05       1                  280      80.38259  0.36152481  64.70732
  0.05       1                  290      80.17659  0.36374485  64.51273
  0.05       1                  300      79.98499  0.36618056  64.35458
  0.05       2                   10      94.95278  0.16698885  77.41967
  0.05       2                   20      92.27729  0.21402108  75.11895
  0.05       2                   30      90.20381  0.24842161  73.34509
  0.05       2                   40      88.47204  0.27347481  71.84796
  0.05       2                   50      86.95989  0.29655274  70.53147
  0.05       2                   60      85.72351  0.30989220  69.46308
  0.05       2                   70      84.70950  0.31945543  68.57755
  0.05       2                   80      83.80031  0.32943810  67.74830
  0.05       2                   90      83.02953  0.33709703  67.07857
  0.05       2                  100      82.33278  0.34489168  66.47121
  0.05       2                  110      81.76843  0.34956210  65.93273
  0.05       2                  120      81.21519  0.35581867  65.45524
  0.05       2                  130      80.69198  0.36218344  65.00392
  0.05       2                  140      80.24044  0.36708752  64.59499
  0.05       2                  150      79.84892  0.37101997  64.23833
  0.05       2                  160      79.49319  0.37483541  63.91021
  0.05       2                  170      79.15312  0.37809736  63.59861
  0.05       2                  180      78.88087  0.38081188  63.34291
  0.05       2                  190      78.60422  0.38391909  63.12938
  0.05       2                  200      78.34730  0.38637147  62.89873
  0.05       2                  210      78.10883  0.38890434  62.68628
  0.05       2                  220      77.91352  0.39053235  62.52633
  0.05       2                  230      77.73878  0.39187175  62.35417
  0.05       2                  240      77.53966  0.39428180  62.16204
  0.05       2                  250      77.40506  0.39535889  62.02569
  0.05       2                  260      77.27961  0.39647647  61.91770
  0.05       2                  270      77.14085  0.39785577  61.79482
  0.05       2                  280      76.98501  0.39975684  61.64927
  0.05       2                  290      76.88416  0.40069247  61.56208
  0.05       2                  300      76.74610  0.40226666  61.43407
  0.05       3                   10      94.01492  0.19872389  76.68482
  0.05       3                   20      90.82915  0.25180426  73.88158
  0.05       3                   30      88.44588  0.28005833  71.78434
  0.05       3                   40      86.43782  0.30406597  70.09591
  0.05       3                   50      84.88794  0.31945854  68.73829
  0.05       3                   60      83.64186  0.33267504  67.66038
  0.05       3                   70      82.59737  0.34413926  66.73941
  0.05       3                   80      81.74714  0.35269819  65.98383
  0.05       3                   90      80.98226  0.36046713  65.30144
  0.05       3                  100      80.30055  0.36800864  64.69420
  0.05       3                  110      79.76705  0.37331882  64.18151
  0.05       3                  120      79.29949  0.37777282  63.75388
  0.05       3                  130      78.85565  0.38191169  63.36995
  0.05       3                  140      78.45196  0.38575748  63.00638
  0.05       3                  150      78.10554  0.38967263  62.69749
  0.05       3                  160      77.81387  0.39250582  62.40214
  0.05       3                  170      77.54240  0.39519184  62.16754
  0.05       3                  180      77.35331  0.39673575  61.97162
  0.05       3                  190      77.12768  0.39897681  61.76505
  0.05       3                  200      76.89778  0.40163817  61.59683
  0.05       3                  210      76.71475  0.40352904  61.43454
  0.05       3                  220      76.55980  0.40501194  61.28956
  0.05       3                  230      76.46657  0.40572905  61.18810
  0.05       3                  240      76.41666  0.40578754  61.12262
  0.05       3                  250      76.31605  0.40676328  61.01621
  0.05       3                  260      76.24119  0.40761051  60.93768
  0.05       3                  270      76.14560  0.40873535  60.85589
  0.05       3                  280      76.07823  0.40940361  60.78782
  0.05       3                  290      76.00919  0.41015805  60.73399
  0.05       3                  300      75.96494  0.41063121  60.68277
  0.10       1                   10      94.24137  0.17152272  76.84841
  0.10       1                   20      91.48856  0.22205615  74.51657
  0.10       1                   30      89.46812  0.25250672  72.73112
  0.10       1                   40      87.73580  0.28147122  71.17974
  0.10       1                   50      86.36685  0.29319174  70.01463
  0.10       1                   60      85.27466  0.30390353  69.06852
  0.10       1                   70      84.30898  0.31452875  68.19493
  0.10       1                   80      83.53196  0.32372634  67.51371
  0.10       1                   90      82.83092  0.33156668  66.89783
  0.10       1                  100      82.22985  0.33787256  66.34362
  0.10       1                  110      81.68324  0.34540571  65.86358
  0.10       1                  120      81.18066  0.35228088  65.42467
  0.10       1                  130      80.72093  0.35742987  65.00676
  0.10       1                  140      80.32755  0.36103060  64.66083
  0.10       1                  150      79.97723  0.36522667  64.34163
  0.10       1                  160      79.61847  0.36963144  64.04553
  0.10       1                  170      79.29837  0.37323486  63.78171
  0.10       1                  180      78.94606  0.37771138  63.46961
  0.10       1                  190      78.67907  0.38021031  63.24651
  0.10       1                  200      78.40913  0.38326301  62.99866
  0.10       1                  210      78.26306  0.38428988  62.86045
  0.10       1                  220      78.06412  0.38595601  62.68695
  0.10       1                  230      77.85685  0.38821266  62.49034
  0.10       1                  240      77.68196  0.38995929  62.34230
  0.10       1                  250      77.54713  0.39139327  62.20854
  0.10       1                  260      77.38875  0.39327551  62.05736
  0.10       1                  270      77.26407  0.39431559  61.96480
  0.10       1                  280      77.09994  0.39640931  61.83475
  0.10       1                  290      76.93714  0.39844026  61.71628
  0.10       1                  300      76.85006  0.39920562  61.61207
  0.10       2                   10      92.32949  0.20237222  75.14618
  0.10       2                   20      88.44999  0.26630912  71.74947
  0.10       2                   30      85.70067  0.30105732  69.35750
  0.10       2                   40      83.75614  0.32514332  67.68092
  0.10       2                   50      82.44245  0.33786786  66.48371
  0.10       2                   60      81.27957  0.35163030  65.47904
  0.10       2                   70      80.32363  0.36169034  64.52802
  0.10       2                   80      79.56126  0.37142500  63.86437
  0.10       2                   90      78.88436  0.37917565  63.23174
  0.10       2                  100      78.31357  0.38541272  62.75720
  0.10       2                  110      77.84984  0.39036179  62.36940
  0.10       2                  120      77.52629  0.39335021  62.10216
  0.10       2                  130      77.23999  0.39578285  61.78017
  0.10       2                  140      76.97051  0.39910005  61.51633
  0.10       2                  150      76.74547  0.40131035  61.32818
  0.10       2                  160      76.63992  0.40192681  61.25774
  0.10       2                  170      76.45390  0.40413547  61.09049
  0.10       2                  180      76.24797  0.40698751  60.92352
  0.10       2                  190      76.12717  0.40843692  60.80555
  0.10       2                  200      75.96513  0.41056349  60.66165
  0.10       2                  210      75.80602  0.41274511  60.52385
  0.10       2                  220      75.78953  0.41280568  60.50379
  0.10       2                  230      75.72661  0.41368432  60.46989
  0.10       2                  240      75.64284  0.41464775  60.37121
  0.10       2                  250      75.60265  0.41510284  60.34489
  0.10       2                  260      75.59967  0.41520537  60.35214
  0.10       2                  270      75.55522  0.41578011  60.32500
  0.10       2                  280      75.51729  0.41645782  60.25077
  0.10       2                  290      75.45147  0.41737259  60.19631
  0.10       2                  300      75.42840  0.41783639  60.17867
  0.10       3                   10      90.59487  0.24568477  73.65767
  0.10       3                   20      86.45190  0.29872801  70.04020
  0.10       3                   30      83.85892  0.32594660  67.75108
  0.10       3                   40      81.88799  0.34687041  65.98706
  0.10       3                   50      80.41664  0.36418986  64.72323
  0.10       3                   60      79.40199  0.37432872  63.87092
  0.10       3                   70      78.56593  0.38295780  63.06346
  0.10       3                   80      77.95754  0.38902290  62.52649
  0.10       3                   90      77.46853  0.39371077  62.06633
  0.10       3                  100      77.07772  0.39804654  61.77035
  0.10       3                  110      76.78899  0.40110933  61.51070
  0.10       3                  120      76.42021  0.40566412  61.17856
  0.10       3                  130      76.21696  0.40775382  60.99491
  0.10       3                  140      76.07339  0.40926076  60.85219
  0.10       3                  150      75.99669  0.40985781  60.75686
  0.10       3                  160      75.89422  0.41102841  60.63304
  0.10       3                  170      75.88549  0.41099052  60.61250
  0.10       3                  180      75.84437  0.41163309  60.57048
  0.10       3                  190      75.78781  0.41228321  60.51710
  0.10       3                  200      75.81115  0.41192641  60.49989
  0.10       3                  210      75.75023  0.41287005  60.46941
  0.10       3                  220      75.72512  0.41304944  60.47410
  0.10       3                  230      75.69897  0.41352552  60.44124
  0.10       3                  240      75.63794  0.41454761  60.40699
  0.10       3                  250      75.65046  0.41433864  60.41336
  0.10       3                  260      75.66742  0.41413395  60.37567
  0.10       3                  270      75.67511  0.41398488  60.41305
  0.10       3                  280      75.66432  0.41408897  60.41182
  0.10       3                  290      75.67822  0.41390260  60.40965
  0.10       3                  300      75.62938  0.41471396  60.36917

Tuning parameter 'n.minobsinnode' was held constant at a value of 20
RMSE was used to select the optimal model using the smallest value.
The final values used for the model were n.trees = 300, interaction.depth =
 2, shrinkage = 0.1 and n.minobsinnode = 20.</code></pre>
</div>
</div>
</section>
<section id="visual-model-diagnostic-2" class="level2">
<h2 class="anchored" data-anchor-id="visual-model-diagnostic-2">7.2 Visual Model Diagnostic</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>gbmodel<span class="sc">$</span>bestTune</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    n.trees interaction.depth shrinkage n.minobsinnode
240     300                 2       0.1             20</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gbmodel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>predict_gb <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Actual =</span> testdata<span class="sc">$</span>Math,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Predicted =</span> <span class="fu">predict</span>(gbmodel, <span class="at">newdata =</span> testdata),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Residuals =</span> <span class="fu">predict</span>(gbmodel, <span class="at">newdata =</span> testdata) <span class="sc">-</span> testdata<span class="sc">$</span>Math)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>gb_predvsactual <span class="ot">&lt;-</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="at">data =</span> predict_gb,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">x =</span> Actual, <span class="at">y =</span> Predicted)) <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, <span class="at">color=</span><span class="st">"#dfb2e9"</span>) <span class="sc">+</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#20948b"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predicted vs Actual"</span>) <span class="sc">+</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">plot.background=</span><span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">"#f5f5f5"</span>,<span class="at">colour=</span><span class="st">"#f5f5f5"</span>))</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>gb_residvsactual <span class="ot">&lt;-</span> </span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="at">data =</span> predict_gb,</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">x =</span> Actual, <span class="at">y =</span> Residuals)) <span class="sc">+</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, <span class="at">color=</span><span class="st">"#dfb2e9"</span>) <span class="sc">+</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#20948b"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residuals vs Predicted"</span>) <span class="sc">+</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">plot.background=</span><span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">"#f5f5f5"</span>,<span class="at">colour=</span><span class="st">"#f5f5f5"</span>))</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>gb_predvsactual <span class="sc">+</span> gb_residvsactual <span class="sc">+</span> </span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="statistical-model-evaluation-3" class="level2">
<h2 class="anchored" data-anchor-id="statistical-model-evaluation-3">7.3 Statistical Model Evaluation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>gb_rmse <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(<span class="at">pred =</span> predict_gb<span class="sc">$</span>Predicted, <span class="at">obs =</span> predict_gb<span class="sc">$</span>Actual)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>gb_rsq <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="at">pred =</span> predict_gb<span class="sc">$</span>Predicted, <span class="at">obs =</span> predict_gb<span class="sc">$</span>Actual)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>gb_mae <span class="ot">&lt;-</span> <span class="fu">MAE</span>(<span class="at">pred =</span> predict_gb<span class="sc">$</span>Predicted, <span class="at">obs =</span> predict_gb<span class="sc">$</span>Actual)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>gb_rmse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 75.59326</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>gb_rsq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3951649</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>gb_mae</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60.85604</code></pre>
</div>
</div>
</section>
<section id="variable-importance-1" class="level2">
<h2 class="anchored" data-anchor-id="variable-importance-1">7.4 Variable Importance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">varImp</span>(gbmodel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Blog made with 💜, <a href="https://pusheen.com/">Pusheen</a>, and <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



</body></html>