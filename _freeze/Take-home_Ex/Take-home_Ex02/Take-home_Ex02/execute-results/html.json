{
  "hash": "c1bf9b146c3b7c12b373e27d89c9e9f4",
  "result": {
    "markdown": "---\ntitle: \"Take-on Exercise 2: DataVis Makeover For Take-home Exercise 1\"\ndate: \"01 Jan 2024\"\ndate-modified: \"last-modified\"\neditor: visual\ntoc-depth: 4\nexecute:\n  freeze: true #never re-render during project render\n  echo: true #if false, displays charts without codes\n  eval: true #if false, displays codes without charts\n  warning: false #dont display if there are any warnings\nformat: \n  html:\n    code-fold: false\n    code-overflow: scroll\n    code-summary: \"Show the code\"\n    code-line-numbers: false\n---\n\n\n# 1 Overview\n\nIn the [previous Take-home Exercise](https://akalestale.netlify.app/take-home_ex/take-home_ex01/take-home_ex01), we utilised Exploratory Data Analysis methods and ggplot functions to uncover the distribution of performance among Singaporean students in mathematics, reading, and science. We also explored the relationships between these performance metrics and factors such as schools, gender, and socioeconomic status, leveraging data from the PISA Student Questionnaire Survey.\n\nIn this post, the objective is to enhance the original visualizations created by a fellow classmate based on Ben Jones' data visualisation [four quadrants of clarity and aesthetic](https://dataremixed.com/2012/05/data-visualization-clarity-or-aesthetics/).\n\n![](images/quads.PNG){fig-align=\"center\"}\n\n# 2 Getting Started\n\n## 2.1 Loading Packages\n\n| **Library**                                                                                  | **Description**                                                                                                                                     |\n|--------------------------|----------------------------------------------|\n| [**tidyverse**](https://www.tidyverse.org/)                                                  | A collection of core packages designed for data science, used extensively for data preparation and wrangling.                                       |\n| [**haven**](https://haven.tidyverse.org/)                                                    | To enable R to read and write various data formats such as SAS and SPSS.                                                                            |\n| [**patchwork**](https://patchwork.data-imaginist.com/)                                       | For preparing composite figure created using ggplot2.                                                                                               |\n| [**scales**](https://scales.r-lib.org/)                                                      | For data labels and annotations for ggplot2                                                                                                         |\n| [**ggridges**](https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html) | For ridgeline plots that create the impression of a mountain range. They can be useful for visualising changes in distributions over time or space. |\n| [**ggpubr**](https://github.com/kassambara/ggpubr)                                           | For publication-ready plots.                                                                                                                        |\n| [**ggdist**](https://mjskay.github.io/ggdist/)                                               | For visualisations of distributions and uncertainty.                                                                                                |\n| [**ggtext**](https://wilkelab.org/ggtext/)                                                   | Supports improved text rendering for ggplot2.                                                                                                       |\n| [**ggalt**](https://yonicd.github.io/ggalt/index.html)                                       | A compendium of 'geoms', 'coords', 'stats', scales and fonts for ggplots2.                                                                          |\n| [**ggextra**](https://github.com/daattali/ggExtra)                                           | For adding marginal plots to ggplot2.                                                                                                               |\n\n: {tbl-colwidths=\"\\[20,80\\]\"}\n\nThe following code chunk uses `p_load()` of [**pacman**](https://rpubs.com/akshaypatankar/594834) package to check if tidyverse packages are installed in the computer. If they are, the libraries will be called into R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, haven, patchwork, \n               scales, ggridges, ggdist, ggtext, \n               intsvy, grid, tidyverse, shadowtext,\n               ggpubr)\n```\n:::\n\n\n## 2.2 PISA Data\n\n::: panel-tabset\n## Importing dataset\n\nFirst, the *2022 Student Questionnaire* dataset is downloaded from [OECD's PISA 2022 Database](https://www.oecd.org/pisa/data/2022database/) and imported using the [`read_sas()`](https://haven.tidyverse.org/reference/read_sas.html) function of the [**haven**](https://haven.tidyverse.org/) package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstu <- read_sas(data_file = \"data/cy08msp_stu_qqq.sas7bdat\")\n```\n:::\n\n\nThe dataset is in a tibble dataframe, containing 613,744 observations (rows) across 1,279 variables (columns). Each observation corresponds to an entry from a student who participated in the 2022 PISA survey for students, and the variables correspond to information from students on various aspects of their home, family, and school background.\n\nNote that the first variable *CNT* refers to the country of response. This is used to filter for Singapore (where *CNT = SGP*) responses for our analysis. [`filter()`](https://dplyr.tidyverse.org/reference/filter.html) of the [**dplyr**](https://dplyr.tidyverse.org/) package allows us to perform this extraction of participating country.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstu_SG <- stu %>%\n  filter(CNT == \"SGP\")\n```\n:::\n\n\nThe resulting data contains 6,606 rows/observations across 1,279 columns/variables.\n\nThe *.rds* file format is usually smaller than its SAS file counterpart and will therefore take up less storage space. The *.rds* file will also preserve data types and classes such as factors and dates eliminating the need to redefine data types after loading the file. For fast and space efficient data storage, files can be exported as RDS and re-imported into R using [`write_rds()`](https://readr.tidyverse.org/reference/read_rds.html) and [`read_rds()`](https://readr.tidyverse.org/reference/read_rds.html) respectively.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(stu_SG, \"data/stu_SG.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstu_SG <- read_rds(\"data/stu_SG.rds\")\n```\n:::\n\n\n## Data Wrangling\n\nGiven that the primary focus of this exercise is to provide feedback the visualisations rather than data pre-processing or the choice of variables, I will be following through the same steps taken by the OP to wrangle the data.\n\nThe author uses [`pisa.mean.pv()`](https://img1.wsimg.com/blobby/go/105aeb78-8212-40bb-855d-a52ee90a5f89/downloads/pisa22.pdf?ver=1705429874371) function of the [**instvy**](https://daniel-caro.com/r-intsvy) package to obtain the mean plausible values out of the 10 plausible values provided in the dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nMath_mean_SG <- pisa.mean.pv(pvlabel = paste0(\"PV\",1:10,\"MATH\"), by=\"CNT\", data=stu_SG)\n\nRead_mean_SG <- pisa.mean.pv(pvlabel = paste0(\"PV\",1:10,\"READ\"), by=\"CNT\", data=stu_SG)\n\nSCIE_mean_SG <- pisa.mean.pv(pvlabel = paste0(\"PV\",1:10,\"SCIE\"), by=\"CNT\", data=stu_SG)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nMath_mean_SG\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  CNT Freq   Mean s.e.    SD  s.e\n1 SGP 6606 574.66 1.23 102.8 0.91\n```\n:::\n\n```{.r .cell-code}\nRead_mean_SG\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  CNT Freq   Mean s.e.     SD  s.e\n1 SGP 6606 542.55 1.87 105.89 1.15\n```\n:::\n\n```{.r .cell-code}\nSCIE_mean_SG\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  CNT Freq   Mean s.e.    SD s.e\n1 SGP 6606 561.43 1.33 99.09 1.1\n```\n:::\n:::\n\n\nThe function generates descriptive statistics for each subject, including the mean, frequency, standard error, and standard deviation.\n\nWith that, we can proceed to analyse some of the visualisations shared!\n:::\n\n# 3 DataVis Makeover\n\nIn the next few sections, I will step through some of the [best practices shared](https://isss608-ay2023-24jan.netlify.app/lesson/lesson02/lesson02-designing%20graphs%20to%20enlighten#/title-slide) to make storytelling with data more accessible.\n\n# 3.1 Distribution of Subject Scores\n\nThe histograms plotted aim to show the distribution of scores across the 3 subjects, and a overlapping density plot to compare distributions across subjects.\n\n::: panel-tabset\n## Original\n\n![](images/MO1.PNG){fig-align=\"center\" width=\"550\"}\n\nThere are several thoughtful features about the original plot.\n\n**Clarity**\n\n-   **Composite plot:** The composite plot offers a comprehensive view of the distributions of all the target variables simultaneously.\n\n-   **Visualise distributions:** Histogram is appropriate for showcasing distribution in data.\n\n-   **Appropriate labels:** The graph is generally clear, with labels on both axes accompanied by a graph title.\n\n-   **Mean line:** The inclusion of mean line serves as a valuable point of comparison across all the 3 plots, aiding in the assessment of subject scores.\n\n**Aesthetics**\n\n-   **Colour scheme:** The consistent color scheme for each subject throughout the post makes it easier to relate the color to the subject from plot to plot.\n\n## Areas for Improvement\n\n![](images/MO1_1.PNG){fig-align=\"center\" width=\"550\"}\n\nHowever, there are some room for improvement. Each point below corresponds to the annotated labels in the image above.\n\n**Clarity**\n\n1.  **Graph title:** A more concise and informative title that effectively conveys the plot's key message would enhance clarity.\n2.  **x-axis tick marks and scale:** Addressing the inconsistent x-axis ranges across the three histograms would enhance comparability. Currently, the tick marks on the x-axis are 250 units apart for the Reading and Science plots, while they are only 200 units apart for the Math plot. This discrepancy makes it challenging to accurately gauge differences. Adopting a consistent scale for the x-axis would facilitate a more precise and straightforward comparison.\n3.  **Density plot:** The overlapped density plots of all 3 subjects seem quite redundant, especially if the x-axis range can be fixed.\n4.  **Mean line:** The mean in the annotation is derived from the mean scores across Plausible Values 1 to 10, calculated using the `pisa_mean_pv()` function from the **intsvy** package. However, it's important to note that the histogram is plotted using PV1 values, leading to potential misinterpretations and inaccuracies.\n\n**Aesthetic**\n\n5.  **Annotation placement:** The annotation for the mean line covers parts of the histogram. Adjusting the position could improve overall aesthetics.\n6.  **Orientation of y-axis title:** Rotating the y-axis title horizontally would improve reader-friendliness and visual appeal.\n:::\n\n### Remake\n\nThe code chunk below is first used to calculate the mean PV of each subject using PV1.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate mean values for 3 subjects\nmean_m <- round(mean(stu_SG$PV1MATH),0)\nmean_r <- round(mean(stu_SG$PV1READ),0)\nmean_s <- round(mean(stu_SG$PV1SCIE),0)\n```\n:::\n\n\nThe remake features similar histograms with trio of colours to represent each of the subject.\n\n-   Using `element_markdown` within `theme()` enables colour-coding of the graph title.\n-   `limits()` is explicitly declared inside `scale_x_continuous()` to ensure the range of x-axis used is consistent throughout.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Histogram for Math scores\nhist_m <- \n  ggplot(\n    stu_SG, \n    aes(x = PV1MATH)\n  ) +\n  geom_histogram(\n    bins = 25,\n    color = \"#f5f5f5\",\n    fill=\"#629182\",\n    alpha=0.4,\n  ) +\n  \n  # Sets same breaks on the x-axis\n  scale_x_continuous(\n    breaks = scales::pretty_breaks(n = 5),\n  \n    # Set same limits for both plots for consistency\n    limits = c(150,950), \n  ) +\n  \n  # Insert mean line\n  geom_vline(\n    aes(xintercept = mean_m),\n    colour=\"#3E5058\", \n    linewidth = 0.5, \n    linetype = \"dashed\"\n  ) +\n  \n  # Include annotation for mean line\n  annotate(\n    geom = \"text\", \n    x = mean_m-50, \n    y = 870,\n    label = paste0(\"Mean: \", mean_m),\n    color=\"#3E5058\",\n    size = 3,\n  ) + \n  \n  \n  labs(x = NULL, y = NULL\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.y = element_blank(),\n    axis.text.x = element_blank(),\n    panel.grid.major = element_blank(),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\")\n  )\n\n# Histogram for Reading scores\nhist_r <- \n  ggplot(\n    stu_SG, \n    aes(x = PV1READ)\n  ) +\n  geom_histogram(\n    bins = 25,\n    color = \"#f5f5f5\",\n    fill=\"#EF6174\",\n    alpha=0.4,\n  ) +\n  \n  scale_x_continuous(\n    # Sets same breaks on the x-axis\n    breaks = scales::pretty_breaks(n = 5),\n  \n    # Set same limits for both plots for consistency\n    limits = c(150,950), \n  ) +\n  \n  # Insert mean line\n  geom_vline(\n    aes(xintercept = mean_r),\n    colour=\"#3E5058\", \n    linewidth = 0.5, \n    linetype = \"dashed\"\n  ) +\n  \n  # Include annotation for mean line\n  annotate(\n    geom = \"text\", \n    x = mean_r-50, \n    y = 870,\n    label = paste0(\"Mean: \", mean_r),\n    color=\"#3E5058\",\n    size = 3,\n  ) +  \n  labs(x = NULL, y = NULL\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.y = element_blank(),\n    axis.text.x = element_blank(),\n    panel.grid.major = element_blank(),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\")\n  )\n\nhist_s <- \n  ggplot(\n    stu_SG, \n    aes(x = PV1SCIE)\n  ) +\n  geom_histogram(\n    bins = 25,\n    color = \"#f5f5f5\",\n    fill=\"#FEBc44\",\n    alpha= 0.4,\n  ) +\n\n  scale_x_continuous(\n    # Sets same breaks on the x-axis\n    breaks = scales::pretty_breaks(n = 5),\n  \n    # Set same limits for both plots for consistency\n    limits = c(150,950), \n  ) +\n  \n  # Insert mean line\n  geom_vline(\n    aes(xintercept = mean_s),\n    colour=\"#3E5058\", \n    linewidth = 0.5, \n    linetype = \"dashed\"\n  ) +\n  # Include annotation for mean line\n  annotate(\n    geom = \"text\", \n    x = mean_s-50, \n    y = 870,\n    label = paste0(\"Mean: \", mean_s),\n    color=\"#3E5058\",\n    size = 3,\n  ) +  \n  labs(x = \"Scores\", y = NULL\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.y = element_blank(),\n    axis.line.x = element_line(),\n    panel.grid.major = element_blank(),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\")\n  )\n\np1 <- (hist_m / hist_r)\np1 / hist_s  + \n  plot_layout(heights = c(1,1,1)) +\n  plot_annotation(title=\"Mean scores in <span style='color: #629182;'>Math</span> > <span style='color: #EF6174;'>Reading</span> and <span style='color: #FEBc44;'>Science</span>.\", \n                  subtitle = \"Normal distribution across all subjects.\",\n                  theme=theme(plot.title = element_markdown(hjust = 0, face=\"bold\"),\n                  plot.background = element_rect(fill=\"#f5f5f5\", colour = \"#f5f5f5\"),\n                  panel.border = element_blank()))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n**Clarity**\n\n1.    **Graph title:** TThe title encapsulates the primary observation derived from the graph. The utilization of colour-coded words for each subject obviates the necessity for a legend, fostering subject identification.\n2.    **x-axis tick marks and scale:**  The histograms consolidated into a single column with a unified x-axis, exhibit aligned bin numbers across each subject, enhancing clarity and comparability.\n3.    **Mean Line:** The mean using PV1 values for each subject, ensures a more precise benchmarking process, contributing to the graph's accuracy.\n\n**Aesthetic**\n\n4.  **Annotation placement:** The move of the mean line's annotation to the top enhances the overall view of the plot, avoiding obstruction.\n\n## 3.2 Relationship between Scores and School ID\n\nThe author opted for a bubble plot, an extension of the scatter plot, to examine the relationship between subject scores and School ID.\n\n::: panel-tabset\n## Original\n\n![](images/MO2.PNG){fig-align=\"center\" width=\"550\"}\n\n**Clarity**\n\n-   The graph layout is clear and user-friendly. The tabset format allows easy naivgation across different subjects' plot.\n\n-   The Interactive plot with a tooltips makes it convenient to identify School ID, average score, and frequency.\n\n## Areas for Improvement\n\n![](images/MO2_1.PNG){fig-align=\"center\" width=\"550\"}\n\n**Clarity**\n\n1.  **Use of a bubble plot:** The bubble plot may not be the most effective way to visualise scores (continuous variable) against School ID (categorical variable). Scatter plots are typically more suited for charting 2 continuous variables.\n2.  **Colour scale:** The colour transition lacks obvious distinction, most of the points appear to be of similar density. A more contrasting colour scale would improve visual differentiation.\n3.  **Colour and location of annotations:** Annotations close to the axis may be challenging to locate and can be easily overlooked, especially when they blend in with the colour of the bubbles.\n\n**Aesthetic**\n\n4.  **Orientation of y-axis title:** Rotating the y-axis title horizontally would be more reader-friendly.\n5.  **Length of legend name:** Shortening the legend's title or allowing it to extend across a second line would create more space for the actual plot.\n:::\n\n### Remake\n\nFirstly, `as.character()` is used to convert the *SchID* variable from numeric to categorical data type.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert School ID to character\n\nstu_SG <- stu_SG %>%\n  mutate(CNTSCHID = as.character(CNTSCHID))\n```\n:::\n\n\nUsing `n_distinct` we can identify that there are 164 unique school IDs in our dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn_distinct(stu_SG$CNTSCHID)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 164\n```\n:::\n:::\n\n\nRather than cramming all 164 points of data into a plot, visualising the top 5 and bottom 5 results by subject performanceshould convey the message sufficiently. The below code serves the following purpose:\n\n-   `group_by` and `mutate`;\n-   `summarize()`, `count = n()` and `mean()`: This summarizes the grouped data, calculating the count of observations within each school and the overall mean scores for each subject across all schools.\n-   `dense_rank(avg_sci) <= 5 and dense_rank(desc(avg_sci)) <= 5` are then used filter the top 5 and bottom 5 schools based on the average subject scores.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nstu_SG_schools <- \n  stu_SG %>% \n  group_by(CNTSCHID) %>% \n  mutate(avg_math = mean(c_across(PV1MATH), na.rm=TRUE),\n         avg_read = mean(c_across(PV1READ), na.rm=TRUE),\n         avg_sci = mean(c_across(PV1SCIE), na.rm=TRUE)) %>% \n  summarize(Count = n(),\n            avg_math = mean(avg_math, na.rm = TRUE),\n            avg_read = mean(avg_read, na.rm = TRUE),\n            avg_sci = mean(avg_sci, na.rm = TRUE))  \n\nstu_SG_schools_m <-\n  stu_SG_schools %>% \n  filter(dense_rank(avg_math) <= 5 | dense_rank(desc(avg_math)) <= 5)\n\nstu_SG_schools_r <-\n  stu_SG_schools %>% \n  filter(dense_rank(avg_read) <= 5 | dense_rank(desc(avg_read)) <= 5)\n\nstu_SG_schools_s <-\n  stu_SG_schools %>% \n  filter(dense_rank(avg_sci) <= 5 | dense_rank(desc(avg_sci)) <= 5)\n```\n:::\n\n\n\nThe remade version showcases a lollipop plot, akin to a barplot, where the traditional bar is transformed into a combination of a line and a dot. This visualisation illustrates the relationship between a numeric variable (average subject scores per school) and a categorical variable (school).\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nlolly_m <-\n  ggplot(stu_SG_schools_m, \n       aes(x = avg_math, \n           y = reorder(CNTSCHID, avg_math))) +\n  \n  geom_segment(aes(x=0, \n                 xend=avg_math, \n                 y=CNTSCHID, \n                 yend=CNTSCHID),\n             color= if_else(stu_SG_schools_m$CNTSCHID %in% c(\"70200003\"), \"#69aebf\", \n                            if_else(stu_SG_schools_m$CNTSCHID %in% c(\"70200056\", \"70200115\", \"70200149\"), \"#dc7068\",\"#989d9e\")\n                            ),\n             alpha = 0.5,\n             linewidth= 4.2)+\n  \n  geom_point(color= if_else(stu_SG_schools_m$CNTSCHID %in% c(\"70200003\"), \"#69aebf\", \n                            if_else(stu_SG_schools_m$CNTSCHID %in% c(\"70200056\", \"70200115\", \"70200149\"), \"#dc7068\",\"#989d9e\")),\n             alpha = 0.8,\n             size = 3.5)+            \n  \n  geom_text(data = stu_SG_schools_m,\n             aes(label = paste(CNTSCHID), \n                 x = 130, \n                 y = CNTSCHID),\n             color = if_else(stu_SG_schools_m$CNTSCHID %in% c(\"70200003\", \"70200056\", \"70200115\", \"70200149\"), \n                             \"white\",\n                             \"#2e272A\"),\n             size = 3,\n            fontface= if_else(stu_SG_schools_m$CNTSCHID %in% c(\"70200003\", \"70200056\", \"70200115\", \"70200149\"), \n                             \"bold\",\n                             \"plain\")) +\n  \n  # Data callout\n  geom_text(aes(label=round(avg_math,0)\n                ),\n            color=if_else(stu_SG_schools_m$CNTSCHID %in% c(\"70200003\"), \"#69aebf\", \n                            if_else(stu_SG_schools_m$CNTSCHID %in% c(\"70200056\", \"70200115\", \"70200149\"), \"#dc7068\",\"#2e272A\")\n                            ),\n            size=3,\n            nudge_x= 30,   # move it to the right of the point\n            hjust= 0, # left justify\n            fontface= if_else(stu_SG_schools_m$CNTSCHID %in% c(\"70200003\", \"70200056\", \"70200115\", \"70200149\"), \n                             \"bold\", \n                             \"plain\")) +\n  \n  # Insert mean line\n  geom_vline(\n    aes(xintercept = mean_m),\n    colour=\"#7161f0\", \n    linewidth = 0.5, \n    linetype = \"dashed\"\n  ) +\n  \n  # Include annotation for mean line\n  annotate(\n    geom = \"text\", \n    x = mean_m + 145, \n    y = 3.5,\n    label = paste0(\"Mean:\\n\", mean_m),\n    color=\"#7161f0\",\n    size = 3.2,\n  ) +  \n  scale_x_continuous(\n\n    # Set same limits for plots for consistency\n    limits = c(0,800), \n  ) +  \n  theme_minimal()+\n  labs(\n    x = \"Math\",\n    y = NULL\n  ) +\n  theme(\n    axis.text.y = element_blank(),\n    axis.ticks.y = element_blank(),\n    axis.text.x = element_blank(),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\"),\n    panel.grid = element_blank()\n  )  \n\nlolly_r <-\n  ggplot(stu_SG_schools_r, \n       aes(x = avg_read, \n           y = reorder(CNTSCHID, avg_read))) +\n  \n  geom_segment(aes(x=0, \n                 xend=avg_read, \n                 y=CNTSCHID, \n                 yend=CNTSCHID),\n             color= if_else(stu_SG_schools_r$CNTSCHID %in% c(\"70200003\"), \"#69aebf\", \n                            if_else(stu_SG_schools_r$CNTSCHID %in% c(\"70200056\", \"70200115\", \"70200149\"), \"#dc7068\",\"#989d9e\")\n                            ),\n             alpha = 0.5,\n             linewidth= 4.2)+\n  \n  geom_point(color= if_else(stu_SG_schools_r$CNTSCHID %in% c(\"70200003\"), \"#69aebf\", \n                            if_else(stu_SG_schools_r$CNTSCHID %in% c(\"70200056\", \"70200115\", \"70200149\"), \"#dc7068\",\"#989d9e\")),\n             alpha = 0.8,\n             size = 3.5)+            \n  \n  geom_text(data = stu_SG_schools_r,\n             aes(label = paste(CNTSCHID), \n                 x = 130, \n                 y = CNTSCHID),\n             color = if_else(stu_SG_schools_r$CNTSCHID %in% c(\"70200003\", \"70200056\", \"70200115\", \"70200149\"), \n                             \"white\",\n                             \"#2e272A\"),\n             size = 3,\n            fontface= if_else(stu_SG_schools_r$CNTSCHID %in% c(\"70200003\", \"70200056\", \"70200115\", \"70200149\"), \n                             \"bold\",\n                             \"plain\")) +\n  \n  # Data callout\n  geom_text(aes(label=round(avg_read,0)\n                ),\n            color=if_else(stu_SG_schools_r$CNTSCHID %in% c(\"70200003\"), \"#69aebf\", \n                            if_else(stu_SG_schools_r$CNTSCHID %in% c(\"70200056\", \"70200115\", \"70200149\"), \"#dc7068\",\"#2e272A\")\n                            ),\n            size=3,\n            nudge_x= 30,   # move it to the right of the point\n            hjust= 0, # left justify\n            fontface= if_else(stu_SG_schools_r$CNTSCHID %in% c(\"70200003\", \"70200056\", \"70200115\", \"70200149\"), \n                             \"bold\", \n                             \"plain\")) +\n  \n  # Insert mean line\n  geom_vline(\n    aes(xintercept = mean_r),\n    colour=\"#7161f0\", \n    linewidth = 0.5, \n    linetype = \"dashed\"\n  ) +\n  \n  # Include annotation for mean line\n  annotate(\n    geom = \"text\", \n    x = mean_r + 145, \n    y = 3.5,\n    label = paste0(\"Mean:\\n\", mean_r),\n    color=\"#7161f0\",\n    size = 3.2,\n  ) +  \n  scale_x_continuous(\n\n    # Set same limits for plots for consistency\n    limits = c(0,800), \n  ) +  \n  theme_minimal()+\n  labs(\n    x = \"Reading\",\n    y = NULL\n  ) +\n  theme(\n    axis.text.y = element_blank(),\n    axis.ticks.y = element_blank(),\n    axis.text.x = element_blank(),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\"),\n    panel.grid = element_blank()\n  ) \n\nlolly_s <-\n  ggplot(stu_SG_schools_s, \n       aes(x = avg_sci, \n           y = reorder(CNTSCHID, avg_sci))) +\n  \n  geom_segment(aes(x=0, \n                 xend=avg_sci, \n                 y=CNTSCHID, \n                 yend=CNTSCHID),\n             color= if_else(stu_SG_schools_s$CNTSCHID %in% c(\"70200003\"), \"#69aebf\", \n                            if_else(stu_SG_schools_s$CNTSCHID %in% c(\"70200056\", \"70200115\", \"70200149\"), \"#dc7068\",\"#989d9e\")\n                            ),\n             alpha = 0.5,\n             linewidth= 4.2)+\n  \n  geom_point(color= if_else(stu_SG_schools_s$CNTSCHID %in% c(\"70200003\"), \"#69aebf\", \n                            if_else(stu_SG_schools_s$CNTSCHID %in% c(\"70200056\", \"70200115\", \"70200149\"), \"#dc7068\",\"#989d9e\")),\n             alpha = 0.8,\n             size = 3.5)+            \n  \n  geom_text(data = stu_SG_schools_s,\n             aes(label = paste(CNTSCHID), \n                 x = 130, \n                 y = CNTSCHID),\n             color = if_else(stu_SG_schools_s$CNTSCHID %in% c(\"70200003\", \"70200056\", \"70200115\", \"70200149\"), \n                             \"white\",\n                             \"#2e272A\"),\n             size = 3,\n            fontface= if_else(stu_SG_schools_s$CNTSCHID %in% c(\"70200003\", \"70200056\", \"70200115\", \"70200149\"), \n                             \"bold\",\n                             \"plain\")) +\n  \n  # Data callout\n  geom_text(aes(label=round(avg_sci,0)\n                ),\n            color=if_else(stu_SG_schools_s$CNTSCHID %in% c(\"70200003\"), \"#69aebf\", \n                            if_else(stu_SG_schools_s$CNTSCHID %in% c(\"70200056\", \"70200115\", \"70200149\"), \"#dc7068\",\"#2e272A\")\n                            ),\n            size=3,\n            nudge_x= 30,   # move it to the right of the point\n            hjust= 0, # left justify\n            fontface= if_else(stu_SG_schools_s$CNTSCHID %in% c(\"70200003\", \"70200056\", \"70200115\", \"70200149\"), \n                             \"bold\", \n                             \"plain\")) +\n  \n  # Insert mean line\n  geom_vline(\n    aes(xintercept = mean_s),\n    colour=\"#7161f0\", \n    linewidth = 0.5, \n    linetype = \"dashed\"\n  ) +\n  \n  # Include annotation for mean line\n  annotate(\n    geom = \"text\", \n    x = mean_s + 145, \n    y = 3.5,\n    label = paste0(\"Mean:\\n\", mean_s),\n    color=\"#7161f0\",\n    size = 3.2,\n  ) +  \n  scale_x_continuous(\n\n    # Set same limits for plots for consistency\n    limits = c(0,800), \n  ) +  \n  theme_minimal()+\n  labs(\n    x = \"Science\",\n    y = NULL\n  ) +\n  theme(\n    axis.text.y = element_blank(),\n    axis.ticks.y = element_blank(),\n    axis.text.x = element_blank(),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\"),\n    panel.grid = element_blank()\n  ) \n\nlolly_m + lolly_r + lolly_s +\n  plot_layout(widths=c(1.2,1,1)) +\n  plot_annotation(title=\"Uneven distribution of scores across schools\",\n                  subtitle=\"School <span style='color: #69aebf;'>70200003</span> has one of the highest mean scores across all subjects,<br> while schools <span style='color: #dc7068;'>70200056, 70200115, 70200149</span> remained at the bottom consistently.\",\n                  theme=theme(plot.title = element_markdown(hjust = 0, face=\"bold\"),\n                              plot.subtitle = element_markdown(hjust = 0),\n                              plot.background = element_rect(fill=\"#f5f5f5\", colour = \"#f5f5f5\"),\n                              panel.border = element_blank()))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n**Clarity**\n\n1.    **Use of a lollipop plot:** The lollipop plot is a straightforward yet effective visualisation of the top and bottom average scores by school. The schools are sorted in descending order based on their scores for each subject to enhance interpretability.\n2.    **Colour:** The use of colors, with blue highlighting consistently high-performing schools and pink delineating consistently low-performing schools across subjects, serves to direct the reader's attention towards salient findings.\n3.    **Mean line:** The inclusion of a mean line, along with annotations, facilitates easy comparison of school performance against the average score for each subject across all schools.\n4.    **Chart labelling**: Each point in the graph is annotated, enhancing overall clarity and providing additional context to the visual representation.\n\n**Aesthetic**\n\n5.  **Removal of y-axis**: The y-axis labels (School IDs) are labelled within the bar for more efficient use of space since 3 plots are combined.\n\n## 3.3 Relationship between Gender and Scores\n\n::: panel-tabset\n## Original\n\n![](images/MO3.PNG){fig-align=\"center\" width=\"550\"}\n\n**Clarity**\n\n-   Density plot with quantile lines is a good choice of chart that helps put emphasis on the difference in median scores between genders.\n\n-   \\-\n\n**Aesthetics**\n\n## Areas for Improvement\n\n![](images/MO3_1.PNG){fig-align=\"center\" width=\"550\"}\n\n**Clarity**\n\n**Aesthetics**\n:::\n\n### Remake\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrcp_long <- \n  stu_SG %>% \n  select(ST004D01T, PV1MATH, PV1READ, PV1SCIE) %>% \n  pivot_longer(cols = starts_with(\"PV1\"),\n               names_to = \"subject\",\n               names_prefix=\"PV1\",\n               values_to=\"score\") %>% \n  mutate(Gender=(recode(ST004D01T, '1'=\"Female\", \n                        '2'=\"Male\"))) %>% \n  select(-ST004D01T)\n```\n:::\n\n\n## 3.4 Relationship between Scores and Socioeconomic Status of Students\n\n\n\n::: panel-tabset\n## Original\n\n![](images/MO4.PNG){fig-align=\"center\" width=\"550\"}\n\n**Clarity**\n\n-   Title summarises the gist of the plot well.\n\n-   Use of consistent colours for each subject helps reader link colour to subject when looking at different plots.\n\n-   \n\n**Aesthetics**\n\n## Areas for Improvement\n\n![](images/MO4_1.PNG){fig-align=\"center\" width=\"550\"}\n\n**Clarity**\n\n1.  **x-axis:** It would probably be more understandable if the ESCS scores are recoded as there was little context provided with regards to how the scores can be interpreted. If kept on a numerical scale, it would be more intuitive for readers if the axis is shifted to beside where the 0 value is as its not immediately obvious there is a positive and negative side to the ESCS score. x-axis is also repeated thrice in this plot.\n\n**Aesthetics**\n\n2.  y-axis title: Adjusting the y-axis title horizontally would improve readability of the plot.\n3.  Graph title: A bolded graph title would stand out more and emphasise on the finding.\n:::\n\n### Remake\n\nThe code chunk below serves assigns a quartile classification to the variable *ESCS* to create 4 roughly equal-sized groups, recodes the variables to more intuitive categories, and finally orders the variables as socio-economic levels increase.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstu_SG <- stu_SG %>%\n  mutate(ESCS = ntile(ESCS, 4), .after = ESCS) %>%\n  \n  mutate(ESCS = recode(ESCS,\n                       `1` = \"Highly Disadvantaged\",\n                       `2` = \"Disadvantaged\",\n                       `3` = \"Advantaged\",\n                       `4` = \"Highly Advantaged\")) %>%\n  \n  mutate(ESCS = factor(ESCS, \n                levels = c(\"Highly Disadvantaged\", \"Disadvantaged\", \n                        \"Advantaged\", \"Highly Advantaged\"),\n                ordered = TRUE)) \n```\n:::\n\n\nThe following code chunk prepares the dataset for plotting using `pivot_longer()` to reshape the data by converting multiple columns into 2 columns. The processed data is then grouped by ECSC category and subject. For each group, it calculates the mean score using the `summarise()` function\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nbar_escs <-\n  stu_SG %>% \n  drop_na(ESCS) %>% \n  select(ESCS, PV1MATH, PV1READ, PV1SCIE) %>% \n  pivot_longer(cols = starts_with(\"PV1\"),\n               names_to = \"subject\",\n               names_prefix=\"PV1\",\n               values_to=\"score\") %>% \n  mutate(subject = recode(subject,\n                       `MATH` = \"Math\",\n                       `READ` = \"Reading\",\n                       `SCIE` = \"Science\")) \n  \nmean_escs <- \n  bar_escs %>% \n  group_by(ESCS, subject) %>% \n  summarise(mean = mean(score, na.rm=TRUE)) %>% \n  mutate(total_avg = if_else(subject==\"MATH\", mean_m, \n                            if_else(subject==\"READ\", mean_r,\n                                    mean_s)))\n```\n:::\n\n\n\nThe strip plot shows the range, density, and central tendencies of each socio-economic level faceted by subject. The points have low alpha value to visualise the density and the purple points refer to the mean of each subject at a socio-economic level. Lastly, a mean line is added for comparison.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nggplot(bar_escs,\n             aes(x = ESCS, y = score)) +\n  coord_flip() +\n  geom_point(size = 3, \n             alpha = 0.1,\n             color=\"#3E5058\") +\n  facet_wrap(~ subject, nrow = 3) +\n  geom_hline(data = mean_escs,\n             aes(yintercept = total_avg),\n             color = \"#c71e1d\",\n             size=1) +\n  geom_segment(\n    data = mean_escs,\n    aes(x = ESCS,\n        xend = ESCS,\n        y = total_avg,\n        yend = mean),\n    color = \"#8c8ed6\",\n    size = 0.8,\n  ) +\n  stat_summary(\n    fun=mean,\n    geom=\"point\",\n    size = 5,\n    color=\"#8c8ed6\",\n  ) +\n\n  scale_y_continuous(limits = c(0, 1000), expand = c(0.02,0.02)) +\n  labs(x = \"English Scores\",\n       y = \"\",\n       title=\"Disparities in academic achievement among different socio-economic<br>groups.\",\n       subtitle=\"Mean values highlighted in <span style='color: #8c8ed6;'>purple</span>.\") +   \n  theme(\n    legend.position = \"none\",\n    #panel.grid.major = element_blank(),\n    axis.title.y = element_blank(),\n    axis.text.y = element_text(),\n    axis.text.x = element_text(),\n    panel.grid = element_blank(),\n    axis.ticks.y = element_blank(),    \n    plot.title = element_markdown(hjust=0),\n    plot.subtitle = element_markdown(hjust = 0),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\"))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n**Clarity**\n\n1.  **x-axis:** \n2. **Mean line**: e can further highlight that the baseline is the average scores for each subject by adding a line from the average of each ESCS level to the subject average. The result is a combination of a strip and lollipop plot.\n\n\n**Aesthetics**\n\n\n\n\n## 3.5 Breakdown of Scores per Subject\n\n::: panel-tabset\n## Original\n\n![](images/MO5.PNG){fig-align=\"center\" width=\"550\"}\n\n**Clarity**\n\n**Aesthetics**\n\n## Areas for Improvement\n\n![](images/MO5_1.PNG){fig-align=\"center\" width=\"550\"}\n\n**Clarity**\n\n**Aesthetics**\n:::\n\n# 4 Summary\n\n5 References\n\nhttps://r-graph-gallery.com/web-dumbbell-chart-with-a-gap-column.html\n",
    "supporting": [
      "Take-home_Ex02_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}