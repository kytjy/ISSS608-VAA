{
  "hash": "4fee8aeab63495f098302a49d66c542e",
  "result": {
    "markdown": "---\ntitle: \"Hands-on Exercise 6: Visualising and Analysing Time-oriented Data\"\ndate: \"04 Feb 2024\"\ndate-modified: \"last-modified\"\neditor: visual\ntoc-depth: 4\nexecute:\n  freeze: true #never re-render during project render\n  echo: true #if false, displays charts without codes\n  eval: true #if false, displays codes without charts\n  warning: false #dont display if there are any warnings\nformat: \n  html:\n    code-fold: false\n    code-overflow: scroll\n    code-summary: \"Show the code\"\n    code-line-numbers: false\n---\n\n\n![](images/time.PNG){fig-align=\"center\"}\n\n# 1 Overview\n\nThis hands-on exercise aims to plot the following data visualsations with R:\n\n-   calender heatmap by using ggplot2 functions,\n-   cycle plot by using ggplot2 function,\n-   slopegraph\n-   horizon chart\n\n# 2 Getting Started\n\n::: panel-tabset \\## Installing & Launching R Packages\n\nFor this exercise, the **scales**, **viridis**, **lubridate**, **ggthemes**, **gridExtra**, **readxl**, **knitr**, **data.table** and **tidyverse** packages will be used.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(scales, viridis, lubridate, \n               ggthemes, gridExtra, readxl, \n               knitr, data.table, \n               CGPfunctions, ggHoriPlot, \n               tidyverse, ggHoriPlot)\n```\n:::\n\n\n# 3 Plotting Calendar Heatmap\n\nObjectives for this section:\n\n-   plot a calender heatmap by using ggplot2 functions and extension,\n-   to write function using R programming,\n-   to derive specific date and time related field by using base R and lubridate packages\n-   to perform data preparation task by using tidyr and dplyr packages.\n\n## 3.1 Step 1: The Data\n\nFor the purpose of this hands-on exercise, *eventlog.csv* file will be used. This data file consists of 199,999 rows of time-series cyber attack records by country.\n\nThe code chunk below is used to import *eventlog.csv* file into R as a data frame *attacks*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nattacks <- read_csv(\"data/eventlog.csv\")\n```\n:::\n\n\n## 3.2 Step 2: Examining the data structure\n\n*kable()* can be used to review the structure of the imported data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nkable(head(attacks))\n```\n\n::: {.cell-output-display}\n|timestamp           |source_country |tz              |\n|:-------------------|:--------------|:---------------|\n|2015-03-12 15:59:16 |CN             |Asia/Shanghai   |\n|2015-03-12 16:00:48 |FR             |Europe/Paris    |\n|2015-03-12 16:02:26 |CN             |Asia/Shanghai   |\n|2015-03-12 16:02:38 |US             |America/Chicago |\n|2015-03-12 16:03:22 |CN             |Asia/Shanghai   |\n|2015-03-12 16:03:45 |CN             |Asia/Shanghai   |\n:::\n:::\n\n\nThere are three columns, namely *timestamp*, *source_country* and *tz*.\n\n-   *timestamp* field stores date-time values in POSIXct format.\n-   *source_country* field stores the source of the attack. It is in *ISO 3166-1 alpha-2* country code.\n-   *tz* field stores time zone of the source IP address.\n\n## 3.3 Step 3: Data Preparation\n\n**Step 1:** Deriving *weekday* and *hour of day* fields\n\nBefore we can plot the calender heatmap, two new fields namely *wkday* and *hour* need to be derived. In this step, we will write a function to perform the task.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmake_hr_wkday <- function (ts, sc, tz) {\n    # convert each time with the appropriate timezone,\n    # the timezone parameter, tz, only takes a single value,\n    # then extract its weekdays and hour  \n  real_times <- ymd_hms(ts,\n                        tz = tz[1],     #<< for group by tz later, simply use the first tz value of groupby\n                        quiet = TRUE)\n  \n  dt <- data.table(source_country = sc,\n                   wkday= weekdays(real_times),\n                   hour = hour(real_times))\n  return (dt)\n}\n```\n:::\n\n\n-   [`ymd_hms()`](https://lubridate.tidyverse.org/reference/ymd_hms.html) and [`hour()`](https://lubridate.tidyverse.org/reference/hour.html) are from [**lubridate**](https://lubridate.tidyverse.org/) package, and\n\n-   [`weekdays()`](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/weekdays) is a **base** R function.\n\n**Step 2:** Deriving the attacks tibble data frame\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# convert weekday and hour into factor so they'll be ordered when plotting\nwkday_levels <- c('Saturday', 'Friday', \n                  'Thursday', 'Wednesday', \n                  'Tuesday', 'Monday', \n                  'Sunday')\n\nattacks <- attacks %>%\n  group_by(tz) %>%\n  do(make_hr_wkday(.$timestamp, \n                   .$source_country, \n                   .$tz)) %>% \n  ungroup() %>% \n  mutate(wkday = factor(wkday, levels = wkday_levels),\n         hour = factor(hour, levels = 0:23))  #<< 24 hrs \n```\n:::\n\n\n::: {.brainbox .brain data-latex=\"brain\"}\n**Explanation of the code chunk above**\n\n1.  **`tz`** refers to the **`tz`** column of the **`attacks`** dataframe.\n2.  **`tz[1]`** selects the first element of the **`tz`** column within each group.\n3.  The **`group_by(tz)`** statement groups the data based on unique values in the **`tz`** column.\n4.  The **`do()`** function is used to apply the **`make_hr_wkday`** function to each group of the grouped dataframe.\n5.  Within the **`make_hr_wkday`** function, **`tz[1]`** is used to specify the time zone for the conversion of the timestamps within each group. Since each group has the same time zone value, using **`tz[1]`** ensures that the function uses the correct time zone for each group.\n\nBy grouping the **`attacks`** dataframe by the **`tz`** column and applying the **`make_hr_wkday`** function within each group, the resulting dataframe will contain the source country, weekday, and hour columns based on the timestamp, source country, and time zone information, grouped by the unique time zones in the **`tz`** column of the **`attacks`** dataframe.\n\nBeside extracting the necessary data into *attacks* data frame, `mutate()` of **dplyr** package is used to convert *wkday* and *hour* fields into **factor** so they'll be ordered when plotting.\n:::\n\nTable below shows the tidy tibble table after processing.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nkable(head(attacks))\n```\n\n::: {.cell-output-display}\n|tz           |source_country |wkday    |hour |\n|:------------|:--------------|:--------|:----|\n|Africa/Cairo |BG             |Saturday |20   |\n|Africa/Cairo |TW             |Sunday   |6    |\n|Africa/Cairo |TW             |Sunday   |8    |\n|Africa/Cairo |CN             |Sunday   |11   |\n|Africa/Cairo |US             |Sunday   |15   |\n|Africa/Cairo |CA             |Monday   |11   |\n:::\n:::\n\n\n## 3.4 Step 4: Building the Calendar Heatmaps\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrouped <- attacks %>% \n  count(wkday, hour) %>% \n  ungroup() %>% \n  na.omit()\n\nggplot(grouped,\n       aes(hour,\n           wkday,\n           fill = n)) +\n  geom_tile(color = 'white',  #<<< border color and line size of tiles\n            size= 0.1) +\n  theme_tufte(base_family = 'Helvetica') + #<< to remove unneccessary graph features\n  coord_equal() + #<< asp ratio of 1:1\n  \n  scale_fill_gradient(name = \"# of attacks\",\n                    low = \"sky blue\", \n                    high = \"dark blue\") +\nlabs(x = NULL, \n     y = NULL, \n     title = \"Attacks by weekday and time of day\") +\ntheme(axis.ticks = element_blank(),\n      plot.title = element_text(hjust=0.5, family = \"Bold\"),\n      axis.title.x = element_blank(),\n      axis.title.y = element_text(hjust=1, angle=0),\n      legend.title = element_text(size = 8),\n      legend.text = element_text(size=6),\n      #legend.key.size = unit(1,\"line\"),\n      plot.background = element_rect(fill = \"#f5f5f5\", color = \"#f5f2f5\"),\n      legend.background = element_rect(fill=\"#f5f5f5\"),\n      panel.background = element_rect(fill=\"#f5f5f5\")\n      )\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex06_files/figure-html/unnamed-chunk-7-1.png){width=624}\n:::\n:::\n\n\n::: {.brainbox .brain data-latex=\"brain\"}\n**Explanation of the code chunk above**\n\n-   a tibble data table called *grouped* is derived by aggregating the attack by *wkday* and *hour* fields.\n-   a new field called *n* is derived by using `group_by()` and `count()` functions.\n-   `count()` is use to count the number of records for each pair of wkday and hour\n-   `na.omit()` is used to exclude missing value.\n-   `geom_tile()` is used to plot tiles (grids) at each x and y position. `color` and `size` arguments are used to specify the border color and line size of the tiles.\n-   [`theme_tufte()`](https://jrnold.github.io/ggthemes/reference/theme_tufte.html) of [**ggthemes**](https://jrnold.github.io/ggthemes/reference/) package is used to remove unnecessary chart junk.\n-   `coord_equal()` is used to ensure the plot will have an aspect ratio of 1:1.\n-   `scale_fill_gradient()` function is used to creates a two colour gradient (low-high).\n:::\n\n## 3.5 Building Multiple Calendar Heatmaps\n\n**Step 1:** Deriving attack by country object\n\nIn order to identify the top 4 countries with the highest number of attacks, you are required to do the followings:\n\n-   count the number of attacks by country,\n-   calculate the percent of attackes by country, and\n-   save the results in a tibble data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nattacks_by_country <- count(attacks, source_country) %>% #<< Count the observations of a country\n  mutate(percent = percent(n/sum(n))) %>% \n  arrange(desc(n))   #<< arranged from largest to smallest count of attacks\n```\n:::\n\n\n**Step 2:** Preparing the tidy data frame\n\nIn this step, you are required to extract the attack records of the top 4 countries from *attacks* data frame and save the data in a new tibble data frame (i.e. *top4_attacks*).\n\nFirst, prepare vector of top 4 country names:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop4 <- attacks_by_country$source_country[1:4] #<< Top 4 countries \nsummary(top4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Length     Class      Mode \n        4 character character \n```\n:::\n\n```{.r .cell-code}\ntop4\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"CN\" \"US\" \"KR\" \"NL\"\n```\n:::\n:::\n\n\nWe can achieve the same thing using `top_n()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop4 <- attacks_by_country %>%  top_n(4, wt= n) %>% pull(source_country)\n```\n:::\n\n\nNext, create **top4_attacks** dataframe by using 'top4' list to filter 'attacks' dataframe.\n\nThis is more reproducible than manually listing the countries to filter, eg `filter(source_country %in% c('CN', 'US', 'KR', 'NL'))`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop4_attacks <- attacks %>% \n  filter(source_country %in% top4) %>% \n  count(source_country, wkday,hour) %>% \n  ungroup() %>% \n  mutate(source_country = factor(\n    source_country, levels = top4)) %>% \n  na.omit()\n```\n:::\n\n\n::: {.brainbox .brain data-latex=\"brain\"}\n'top4_attacks' dataframe is similar to 'grouped' dataframe, except that it has one more column called 'source_country'. This additional column will be useful for faceting later.\n:::\n\n**Step 3:** Plotting Multiple Calendar Heatmaps using ggplot2 package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(top4_attacks, \n       aes(hour, \n           wkday, \n           fill = n)) + \n  geom_tile(color = \"white\", \n          size = 0.1) + \n  theme_tufte(base_family = \"Helvetica\") + \n  coord_equal() +\n  scale_fill_gradient(name = \"Number of Attacks\",\n                    low = \"sky blue\", \n                    high = \"dark blue\") +\n  facet_wrap(~source_country, ncol = 2) +\n  labs(x = NULL, y = NULL, \n     title = \"Attacks on top 4 countries by weekday and time of day\") +\n  theme(axis.ticks = element_blank(),\n        axis.text.x = element_text(size = 7),\n        plot.title = element_text(hjust = 0.5),\n        legend.title = element_text(size = 8),\n        legend.text = element_text(size = 6),\n        legend.position = \"bottom\",\n        plot.background = element_rect(fill = \"#f5f5f5\", color = \"#f5f2f5\"),\n        legend.background = element_rect(fill=\"#f5f5f5\"),\n        panel.background = element_rect(fill=\"#f5f5f5\"),\n        panel.border = element_blank(),\n\n      )\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex06_files/figure-html/unnamed-chunk-12-1.png){width=758.4}\n:::\n:::\n\n\n# 4 Plotting Cycle Plot\n\nIn this section, we learn how to plot a cycle plot showing the time-series patterns and trend of visitor arrivals from Vietnam programmatically by using ggplot2 functions.\n\n## 4.1 Step 1: Data Import\n\nThe dataset *arrivals_by_air.xlsx* will be used. The code chunk below imports *arrivals_by_air.xlsx* by using `read_excel()` of **readxl** package and save it as a tibble data frame called *air*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nair <- read_excel(\"data/arrivals_by_air.xlsx\")\n\nair %>% \n  head(5) %>% \n  kable()\n```\n\n::: {.cell-output-display}\n|Month-Year | Republic of South Africa| Canada|   USA| Bangladesh| Brunei| China| Hong Kong SAR (China)| India| Indonesia| Japan| South Korea| Kuwait| Malaysia| Myanmar| Pakistan| Philippines| Saudi Arabia| Sri Lanka| Taiwan| Thailand| United Arab Emirates| Vietnam| Belgium & Luxembourg|  CIS| Finland| France| Germany| Ireland| Italy| Netherlands| Spain| Switzerland| United Kingdom| Australia| New Zealand|\n|:----------|------------------------:|------:|-----:|----------:|------:|-----:|---------------------:|-----:|---------:|-----:|-----------:|------:|--------:|-------:|--------:|-----------:|------------:|---------:|------:|--------:|--------------------:|-------:|--------------------:|----:|-------:|------:|-------:|-------:|-----:|-----------:|-----:|-----------:|--------------:|---------:|-----------:|\n|2000-01-01 |                     3291|   5545| 25906|       2883|   3749| 33895|                 13692| 19235|     65151| 59288|       21457|    507|    27472|    1177|     2150|        8404|         1312|      3922|  15766|    12048|                 1318|    1527|                 1434| 2703|    1634|   4752|   12739|    1292|  3544|        4962|   925|        3731|          28986|     34616|        5034|\n|2000-02-01 |                     2357|   6120| 28262|       2469|   3236| 34344|                 19870| 18975|     37105| 58188|       19634|    199|    29084|    1161|     2496|        9128|          623|      3988|  24861|    12745|                  899|    2269|                 1596| 1182|    1297|   6391|   13093|    1200|  2897|        5054|   747|        3980|          35148|     26030|        3938|\n|2000-03-01 |                     4036|   6255| 30439|       2904|   3342| 27053|                 17086| 21049|     44205| 74426|       20719|    386|    30504|    1355|     2429|       11691|         1578|      4259|  18767|    16971|                 1474|    2034|                 1548| 1088|    1220|   5528|   13645|    1368|  2717|        4950|   935|        3576|          36117|     31119|        4668|\n|2000-04-01 |                     4241|   4521| 25378|       2843|   5117| 30464|                 22346| 26160|     45480| 49985|       17489|    221|    34478|    1593|     2711|       14141|          705|      6579|  22735|    20397|                 1284|    2420|                 1592| 1012|    1208|   5544|   13366|    1345|  2512|        4149|   941|        3850|          33792|     34824|        6890|\n|2000-05-01 |                     2841|   3914| 26163|       2793|   4152| 30775|                 16357| 35869|     38350| 48937|       19398|    164|    34795|    1397|     2594|       13305|          679|      4625|  18399|    15769|                 1042|    1833|                 1167|  660|     743|   4225|   10878|    1067|  2205|        3643|   764|        3025|          23377|     33139|        7006|\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nglimpse(air)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 240\nColumns: 36\n$ `Month-Year`               <dttm> 2000-01-01, 2000-02-01, 2000-03-01, 2000-0…\n$ `Republic of South Africa` <dbl> 3291, 2357, 4036, 4241, 2841, 2776, 3728, 2…\n$ Canada                     <dbl> 5545, 6120, 6255, 4521, 3914, 3487, 4238, 4…\n$ USA                        <dbl> 25906, 28262, 30439, 25378, 26163, 28179, 2…\n$ Bangladesh                 <dbl> 2883, 2469, 2904, 2843, 2793, 3146, 3489, 3…\n$ Brunei                     <dbl> 3749, 3236, 3342, 5117, 4152, 5018, 5026, 6…\n$ China                      <dbl> 33895, 34344, 27053, 30464, 30775, 26720, 3…\n$ `Hong Kong SAR (China)`    <dbl> 13692, 19870, 17086, 22346, 16357, 18133, 2…\n$ India                      <dbl> 19235, 18975, 21049, 26160, 35869, 31314, 2…\n$ Indonesia                  <dbl> 65151, 37105, 44205, 45480, 38350, 47982, 5…\n$ Japan                      <dbl> 59288, 58188, 74426, 49985, 48937, 53798, 6…\n$ `South Korea`              <dbl> 21457, 19634, 20719, 17489, 19398, 17522, 2…\n$ Kuwait                     <dbl> 507, 199, 386, 221, 164, 440, 1943, 2694, 4…\n$ Malaysia                   <dbl> 27472, 29084, 30504, 34478, 34795, 34660, 2…\n$ Myanmar                    <dbl> 1177, 1161, 1355, 1593, 1397, 1715, 1354, 1…\n$ Pakistan                   <dbl> 2150, 2496, 2429, 2711, 2594, 2924, 4001, 3…\n$ Philippines                <dbl> 8404, 9128, 11691, 14141, 13305, 10555, 968…\n$ `Saudi Arabia`             <dbl> 1312, 623, 1578, 705, 679, 2749, 5748, 4012…\n$ `Sri Lanka`                <dbl> 3922, 3988, 4259, 6579, 4625, 4740, 4764, 5…\n$ Taiwan                     <dbl> 15766, 24861, 18767, 22735, 18399, 21042, 2…\n$ Thailand                   <dbl> 12048, 12745, 16971, 20397, 15769, 17217, 1…\n$ `United Arab Emirates`     <dbl> 1318, 899, 1474, 1284, 1042, 1545, 3641, 33…\n$ Vietnam                    <dbl> 1527, 2269, 2034, 2420, 1833, 2480, 2221, 2…\n$ `Belgium & Luxembourg`     <dbl> 1434, 1596, 1548, 1592, 1167, 1170, 1912, 1…\n$ CIS                        <dbl> 2703, 1182, 1088, 1012, 660, 712, 911, 864,…\n$ Finland                    <dbl> 1634, 1297, 1220, 1208, 743, 982, 680, 1029…\n$ France                     <dbl> 4752, 6391, 5528, 5544, 4225, 4047, 5769, 6…\n$ Germany                    <dbl> 12739, 13093, 13645, 13366, 10878, 9054, 10…\n$ Ireland                    <dbl> 1292, 1200, 1368, 1345, 1067, 1363, 1348, 1…\n$ Italy                      <dbl> 3544, 2897, 2717, 2512, 2205, 2196, 2988, 6…\n$ Netherlands                <dbl> 4962, 5054, 4950, 4149, 3643, 3544, 5969, 5…\n$ Spain                      <dbl> 925, 747, 935, 941, 764, 855, 1163, 1669, 1…\n$ Switzerland                <dbl> 3731, 3980, 3576, 3850, 3025, 2580, 3656, 2…\n$ `United Kingdom`           <dbl> 28986, 35148, 36117, 33792, 23377, 21769, 2…\n$ Australia                  <dbl> 34616, 26030, 31119, 34824, 33139, 35731, 4…\n$ `New Zealand`              <dbl> 5034, 3938, 4668, 6890, 7006, 7634, 9502, 6…\n```\n:::\n:::\n\n\nNote that *Month-year* column is detected as date-time format in R.\n\n## 4.2 Step 2: Deriving month and year fields\n\nNext, two new fields called *month* and *year* are derived from *Month-Year* field.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nair$month <- factor(month(air$`Month-Year`),  # extract month\n                    levels = 1:12,  #<< 12 months\n                    ordered= TRUE)\n\nair$year <- year(ymd(air$`Month-Year`))   # extract year\n```\n:::\n\n\n## 4.3 Step 3: Extracting the target country\n\nNext, the code chunk below is use to create dataframe containing the arrival data for Vietnam from 2010 onwards by selecting columns 'Vietnam', ' month' and 'year' from the air dataframe.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nVietnam <- air %>% \n  select(`Vietnam`, \n         month, \n         year) %>%\n  filter(year >= 2010)\n```\n:::\n\n\n## 4.4 Step 4: Computing year average arrivals by month\n\nThe code chunk below uses `group_by()` and `summarise()` of **dplyr** to compute year average arrivals by month for all the years in *Vietnam* dataframe.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nhline.data <- Vietnam %>% \n  group_by(month) %>%\n  summarise(avgvalue = mean(`Vietnam`))\n```\n:::\n\n\n## 4.5 Step 5: Plotting the cycle plot\n\nThe code chunk below is used to plot the cycle plot.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nggplot() + \n  geom_line(data=Vietnam,\n            aes(x=factor(year), \n                y=`Vietnam`, \n                group=month), \n            colour=\"black\") +\n  geom_hline(aes(yintercept=avgvalue),  #<< geom_hline does not require group=month for facet?\n             data=hline.data, \n             linetype=6, \n             colour=\"red\", \n             size=0.5) + \n  facet_grid(~month) +\n  labs(axis.text.x = element_blank(),\n       title = \"Visitor arrivals from Vietnam by air, Jan 2010-Dec 2019\") +\n  ylab(\"No. of Visitors\") +\n  theme(axis.text.x = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.title.x = element_blank(),\n    plot.title = element_text(hjust = 0.5),\n        legend.title = element_text(size = 8),\n        legend.text = element_text(size = 6),\n        plot.background = element_rect(fill = \"#f5f5f5\", color = \"#f5f2f5\"),\n        legend.background = element_rect(fill=\"#f5f5f5\"),\n        panel.background = element_rect(fill=\"#f5f5f5\")\n      ) \n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex06_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n# 5 Plotting Slopegraph\n\nIn this section, we learn how to plot a [slopegraph](https://www.storytellingwithdata.com/blog/2020/7/27/what-is-a-slopegraph) with R.\n\nEnsure **CGPfunctions** is installed and loaded in R. For more reference materials, refer to [Using newggslopegraph](https://cran.r-project.org/web/packages/CGPfunctions/vignettes/Using-newggslopegraph.html) and [`newggslopegraph()`](https://www.rdocumentation.org/packages/CGPfunctions/versions/0.6.3/topics/newggslopegraph).\n\n## 5.1 Step 1: Data Import\n\nImport the rice data set into R environment by using the code chunk below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrice <- read_csv(\"data/rice.csv\")\n```\n:::\n\n\nNotice that 'year' column is in the wrong format of number. We should convert it to factor instead.\n\n## 5.2 Step 2: Plotting the slopegraph\n\nNext, code chunk below will be used to plot a basic slopegraph as shown below.\n\nKey arguments include: - `Times`: - `Measurement`: Where the highest values are at the top of the graph. - `Grouping`:\n\nSince slopegraph contains information only for two years, we will filter data in 1960 and 1980 only.\n\n`factor()` is used convert the value type of *Year* field from numeric to factor.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nrice %>% \n  mutate(Year = factor(Year)) %>%\n  filter(Year %in% c(1961, 1980)) %>%\n  newggslopegraph(Times = Year, \n                  Measurement = Yield, \n                  Grouping = Country,\n                Title = \"Rice Yield of Top 11 Asian Counties\",\n                SubTitle = \"1961-1980\",\n                Caption = \"My VA Prof: Dr. Kam Tin Seong\",\n                DataLabelFillColor = \"#f5f5f5\",) +\n    theme(\n        plot.background = element_rect(fill = \"#f5f5f5\", color = \"#f5f2f5\"),\n        panel.background = element_rect(fill=\"#f5f5f5\")\n      ) \n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex06_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n## 5.3 Highlighting a country\n\nLineColor is simply a character vector that you can fill any way you choose.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nrice %>% \n  mutate(Year = factor(Year)) %>%\n  filter(Year %in% c(2005, 2006, 2007, 2008, 2009, 2010)) %>%\n  newggslopegraph(Year, Yield, Country,\n                Title = \"Rice Yield of Top 11 Asian Counties\",\n                SubTitle = \"2005 to 2010\",\n                Caption = NULL,\n                LineColor = c(\"#c7c8cc\", \"#c7c8cc\", \"#c7c8cc\", \"#c7c8cc\",\"red\",\"#c7c8cc\",\"#c7c8cc\",\"#c7c8cc\",\"#c7c8cc\",\"#c7c8cc\"),      \n                DataLabelFillColor = \"#f5f5f5\",) +\n    theme(\n        plot.background = element_rect(fill = \"#f5f5f5\", color = \"#f5f2f5\"),\n        panel.background = element_rect(fill=\"#f5f5f5\")\n      ) \n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex06_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\nAssigning by country name is much clearer!\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nrice %>% \n  mutate(Year = factor(Year)) %>%\n  filter(Year %in% c(2005, 2006, 2007, 2008, 2009, 2010)) %>%\n  newggslopegraph(Year, Yield, Country,\n                Title = \"Rice Yield of Top 11 Asian Counties\",\n                SubTitle = \"2005 to 2010\",\n                Caption = NULL,\n                LineColor = c(\"Korea\" = \"#e0218a\", \"Thailand\" = \"#FFBC2F\"),\n                DataLabelFillColor = \"#f5f5f5\",) +\n    theme(\n        plot.background = element_rect(fill = \"#f5f5f5\", color = \"#f5f2f5\"),\n        panel.background = element_rect(fill=\"#f5f5f5\")\n      ) \n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex06_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n# 6 BumpCharts in R\n\nAnother popular visualisation is the bump chart, which is a type of line chart which shows changes in rankings over time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrice %>% \n  mutate(Year = factor(Year)) %>%\n  filter(Year %in% c(2005, 2006, 2007, 2008, 2009, 2010)) %>%\n  ggplot(aes(x = Year,\n         y = Yield,\n         color = Country))+\n  geom_point(color = \"#FFFFFF\", size = 1) +\n  ggbump::geom_bump(mapping=aes(x = Year,\n                                y = Yield, \n                                group = Country\n                                ))+\n  labs(title = \"Rice Yield of Top 11 Asian Counties\") +  \n  theme_minimal()+\n  theme(\n        plot.background = element_rect(fill = \"#f5f5f5\", color = \"#f5f2f5\"),\n        panel.background = element_rect(fill=\"#f5f5f5\"))\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex06_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n\n# 7 Horizon Chart (WIP)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrice %>% \n    filter(Year %in% c(2005, 2006, 2007, 2008, 2009, 2010)) %>%\n  ggplot() +\n  geom_horizon(\n    aes(x = factor(Year), \n        y = Yield,\n        fill=  ..Cutpoints..), \n    origin = \"midpoint\", \n    horizonscale = 6\n  )+\n  facet_grid(Country~.) +\n  theme_few() +\n  scale_fill_hcl(palette = 'RdBu') +\n  labs(\n    title = \"Rice Yield of Top 11 Asian Counties (From 2005 to 2010)\"\n  ) +\n  theme(\n    panel.spacing.y = unit(0, \"lines\"), \n    strip.text.y = element_text(size = 5, angle = 0, hjust = 0),\n    legend.position = \"none\",\n    axis.text.y = element_blank(),\n    axis.text.x = element_text(size = 7, angle = 0),\n    axis.title.y = element_blank(),\n    axis.title.x = element_blank(),\n    axis.ticks.y = element_blank(),\n    panel.border = element_blank(),\n    panel.background = element_rect(fill = \"#f5f5f5\", color = \"#f5f5f5\"),\n    plot.background = element_rect(fill = \"#f5f5f5\", color = \"#f5f5f5\"))\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex06_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Hands-on_Ex06_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}