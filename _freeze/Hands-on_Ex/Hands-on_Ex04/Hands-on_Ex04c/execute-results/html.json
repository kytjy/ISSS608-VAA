{
  "hash": "1a2cddffc0c1c1f2ff49da43f820932a",
  "result": {
    "markdown": "---\ntitle: \"Hands-on Exercise 4c: Visualising Uncertainty\"\ndate: \"28 Jan 2024\"\ndate-modified: \"last-modified\"\neditor: visual\ntoc-depth: 4\nexecute:\n  freeze: true #never re-render during project render\n  echo: true #if false, displays charts without codes\n  eval: true #if false, displays codes without charts\n  warning: false #dont display if there are any warnings\nformat: \n  html:\n    code-fold: false\n    code-overflow: scroll\n    code-summary: \"Show the code\"\n    code-line-numbers: false\n---\n\n\n![](images/hop.gif){fig-align=\"center\" width=\"470\"}\n\n# 1 Learning Outcome\n\nVisualising uncertainty poses a significant challenge in data visualisation. When we observe a data point placed at a particular location, we often perceive it as an exact reflection of the true data value. It's hard to grasp that the data point might actually exist within a range beyond where it's plotted. This situation is common in data visualisation, as nearly every dataset contains some degree of uncertainty. The decisions we make about whether and how to depict this uncertainty can greatly impact how accurately our audience understands the data's significance.\n\nIn this chapter, we will gain hands-on experience on creating statistical graphics for visualising uncertainty, including\n\n-   plotting statistics error bars by using ggplot2,\n\n-   plotting interactive error bars by combining ggplot2, plotly and DT,\n\n-   creating advanced by using ggdist, and\n\n-   creating hypothetical outcome plots (HOPs) by using ungeviz package.\n\n# 2 Getting Started\n\n::: panel-tabset\n## Installing and loading libraries\n\nFor the purpose of this exercise, the following R packages will be used, they are:\n\n-   tidyverse, a family of R packages for data science process,\n-   plotly for creating interactive plot,\n-   gganimate for creating animation plot,\n-   DT for displaying interactive html table,\n-   crosstalk for for implementing cross-widget interactions (currently, linked brushing and filtering), and\n-   ggdist for visualising distribution and uncertainty.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndevtools::install_github(\"wilkelab/ungeviz\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(ungeviz, plotly, crosstalk,\n               DT, ggdist, ggridges,\n               colorspace, gganimate, tidyverse,\n               ggiraph)\n```\n:::\n\n\n## Loading the data\n\nLets load the student exam data.csv for our exercise today.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexam <- read_csv('data/Exam_data.csv')\n```\n:::\n\n:::\n\n# 3 Visualizing the uncertainty of point estimates (manual method, without ggdist package)\n\nA point estimate is a single number, such as a mean. Uncertainty is expressed as standard error, confidence interval, or credible interval\n\n::: {.thunderbox .thunder data-latex=\"thunder\"}\nDon't confuse the uncertainty of a point estimate (mean, median..) with the variation in the sample (standard deviation sigma, and variation sigma square etc).\n\nThe standard deviation measures the variation of the values from the mean of ONE sample.\n\nThe standard error is the standard deviation of both sides of the 'mother of all means' of all the sample means. \\<- Refer lecture 4 slide 23\n:::\n\n### 3.1 ggplot2 methods\n\nIn this section, we learn how to plot error bars of maths scores by race by using data provided in exam tibble data frame.\n\nThe code chunk below performs the following:\n\n-   `group_by()` of **dplyr** package groups the observation by RACE,\n\n-   `summarise()` computes the count of observations, mean, standard deviation and standard error of Maths by RACE,\n\n-   `mutate()` is used to derive standard error of Maths by RACE, and\n\n-   save the output as a tibble data table called `my_sum`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_sum <- exam %>% \n      group_by(RACE) %>% \n      summarise(n=n(),\n                mean=mean(MATHS),\n                sd = sd(MATHS)) %>% \n      mutate(se=sd/sqrt(n-1))   #<<< standard error formula\n```\n:::\n\n\nNext, the code chunk below will be used to display *my_sum* tibble data frame in an html table format.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::kable(head(my_sum), format = 'html')\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> RACE </th>\n   <th style=\"text-align:right;\"> n </th>\n   <th style=\"text-align:right;\"> mean </th>\n   <th style=\"text-align:right;\"> sd </th>\n   <th style=\"text-align:right;\"> se </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Chinese </td>\n   <td style=\"text-align:right;\"> 193 </td>\n   <td style=\"text-align:right;\"> 76.50777 </td>\n   <td style=\"text-align:right;\"> 15.69040 </td>\n   <td style=\"text-align:right;\"> 1.132357 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Indian </td>\n   <td style=\"text-align:right;\"> 12 </td>\n   <td style=\"text-align:right;\"> 60.66667 </td>\n   <td style=\"text-align:right;\"> 23.35237 </td>\n   <td style=\"text-align:right;\"> 7.041005 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Malay </td>\n   <td style=\"text-align:right;\"> 108 </td>\n   <td style=\"text-align:right;\"> 57.44444 </td>\n   <td style=\"text-align:right;\"> 21.13478 </td>\n   <td style=\"text-align:right;\"> 2.043177 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Others </td>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:right;\"> 69.66667 </td>\n   <td style=\"text-align:right;\"> 10.72381 </td>\n   <td style=\"text-align:right;\"> 3.791438 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n### 3.1.1 Plotting standard error bars of point estimates\n\nThe code chunk below is used to reveal the **standard error** of **mean** maths score by race. It shows **one** standard deviation away from the 'mother of all means' for all the means from all the samples.\n\n**Impt:** Standard error is a measure of the variation of the mean of all the means from all samples of an underlying distribution.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nggplot(my_sum) +\n  geom_errorbar(aes(x=RACE,\n                    ymin=mean-se,\n                    ymax=mean+se),\n                width = 0.2,\n                colour = 'black',\n                alpha = 0.9,\n                linewidth=0.5) +\n    geom_point(aes(x=RACE,\n                 y=mean),\n             stat = 'identity', #<<< actual points refer to mean \n             color='#e0218a', \n             size = 1.5,\n             alpha = 1) + \n  labs(title=\"Standard error of mean maths score by race\",\n       x= \"Race\",\n       y= \"Mean\") +   \n  theme(\n    legend.position = \"none\",\n    #panel.grid.major = element_blank(),\n    axis.title.y = element_text(hjust=1, angle=0),\n    axis.text.y = element_text(),\n    plot.title = element_text(hjust=0, face=\"bold\"),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\") ,\n    )  \n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex04c_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n::: {.brainbox .brain data-latex=\"brain\"}\n**In the code above:**\n\n-   **`stat = 'identity'`** means that the **`y`** values in the **`geom_point`** layer correspond to the **actual values** in the data frame, rather than a summary statistic like mean or median.\n\n-   The error bars are computed by using the formula mean+/-se.\n:::\n\n### 3.1.2 Plotting confidence interval of point estimates\n\nInstead of plotting the standard error bar of point estimates, we can also plot the confidence intervals of mean maths score by race.\n\nLets plot a 95% confidence interval of mean maths score by race. The error bars should be sorted by the average maths scores. (Refer to take-home ex 1 on sorting by mean)\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nggplot(my_sum) +\n  geom_errorbar(\n    aes(x=reorder(RACE,-mean),  # reorder(x,y) means to reorder x based on increasing or decreasing values of y. To sort by descending values of Y, use -Y.\n                    ymin=mean-1.96*se,    #<<<< formula to calc 95% CI\n                    ymax=mean+ 1.96*se),  #<<<<\n                width = 0.2,\n                colour = 'black',\n                alpha = 0.9,\n                size=0.5) +\n    geom_point(aes(x=RACE,\n                 y=mean),\n             stat = 'identity', #<<< actual points refer to mean \n             color='red', \n             size = 1.5,\n             alpha = 1) + \n  labs(x = \"Maths score\",\n       title = \"95% confidence interval of mean maths score by race\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex04c_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n::: {.brainbox .brain data-latex=\"brain\"}\n**In the code above:**\n\n-   The confidence intervals are computed by using the formula mean+/-1.96\\*se.\n\n-   The error bars is sorted by using the average maths scores.\n\n**What is the difference between standard error plot above and this 95% confidence interval plot?**\n\nEarlier , we plot error bars of 1 standard deviation away from the mother of all means. Here, we are plotting 1.96 \\* standard deviation away from the mother of all means. The higher the % CI, the greater the margin or error.\n:::\n\n### 3.1.3 Visualizing the uncertainty of point estimates with interactive error bars\n\nWe can also plot interactive error bars for the 99% confidence interval of mean maths score by race as shown in the figure below.\n\n::: panel-tabset\n## plotly\n\nCrosstalk's main R API is a **SharedData** R6 class. You use this class to wrap your data frame, and pass it to a Crosstalk-compatible widget where a data frame would normally be expected.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nshared_df = SharedData$new(my_sum)\n\nbscols(widths = c(4,8),\n       ggplotly((ggplot(shared_df) +\n                   geom_errorbar(aes(\n                     x=reorder(RACE, -mean),\n                     ymin=mean-2.58*se, \n                     ymax=mean+2.58*se), \n                     width=0.2, \n                     colour=\"black\", \n                     alpha=0.9, \n                     size=0.5) +\n                   \n                   geom_point(aes(\n                     x=RACE, \n                     y=mean, \n                     text = paste(\"Race:\", `RACE`, \n                                  \"<br>N:\", `n`,\n                                  \"<br>Avg. Scores:\", round(mean, digits = 2),\n                                  \"<br>95% CI:[\", \n                                  round((mean-2.58*se), digits = 2), \",\",\n                                  round((mean+2.58*se), digits = 2),\"]\")),\n                     stat=\"identity\", \n                     color=\"red\", \n                     size = 1.5, \n                     alpha=1) + \n                   xlab(\"Race\") + \n                   ylab(\"Average Scores\") + \n                   theme_minimal() + \n                   theme(axis.text.x = element_text(\n                     angle = 45, vjust = 0.5, hjust=1)) +\n                   ggtitle(\"99% Confidence interval of average /<br>maths scores by race\")),\n                \n                tooltip = \"text\"), \n       \n       DT::datatable(shared_df, \n                     rownames = FALSE, \n                     class=\"compact\", \n                     width=\"100%\", \n                     options = list(pageLength = 8,\n                                    scrollX=T), \n                     colnames = c(\"No. of pupils\", \n                                  \"Avg Scores\",\n                                  \"Std Dev\",\n                                  \"Std Error\")) %>%\n         formatRound(columns=c('mean', 'sd', 'se'),\n                     digits=2))\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"container-fluid crosstalk-bscols\">\n<div class=\"row\">\n<div class=\"col-xs-4\">\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-8a12995162e2b61ab57c\" style=\"width:100%;height:400px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-8a12995162e2b61ab57c\">{\"x\":{\"data\":[{\"x\":[1,3,4,2],\"y\":[76.507772020725383,60.666666666666664,57.444444444444443,69.666666666666671],\"text\":\"\",\"key\":[\"1\",\"2\",\"3\",\"4\"],\"type\":\"scatter\",\"mode\":\"lines\",\"opacity\":0.90000000000000002,\"line\":{\"color\":\"transparent\"},\"error_y\":{\"array\":[2.9214818033282057,18.165794029639137,5.2713960499886028,9.7819093228264933],\"arrayminus\":[2.9214818033282057,18.165794029639137,5.2713960499886028,9.7819093228265004],\"type\":\"data\",\"width\":21.333333333333353,\"symmetric\":false,\"color\":\"rgba(0,0,0,1)\"},\"set\":\"SharedData06443b99\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"_isNestedKey\":false,\"frame\":null},{\"x\":[1,3,4,2],\"y\":[76.507772020725383,60.666666666666664,57.444444444444443,69.666666666666671],\"text\":[\"Race: Chinese <br>N: 193 <br>Avg. Scores: 76.51 <br>95% CI:[ 73.59 , 79.43 ]\",\"Race: Indian <br>N: 12 <br>Avg. Scores: 60.67 <br>95% CI:[ 42.5 , 78.83 ]\",\"Race: Malay <br>N: 108 <br>Avg. Scores: 57.44 <br>95% CI:[ 52.17 , 62.72 ]\",\"Race: Others <br>N: 9 <br>Avg. Scores: 69.67 <br>95% CI:[ 59.88 , 79.45 ]\"],\"key\":[\"1\",\"2\",\"3\",\"4\"],\"type\":\"scatter\",\"mode\":\"markers\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(255,0,0,1)\",\"opacity\":1,\"size\":5.6692913385826778,\"symbol\":\"circle\",\"line\":{\"width\":1.8897637795275593,\"color\":\"rgba(255,0,0,1)\"}},\"hoveron\":\"points\",\"set\":\"SharedData06443b99\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"_isNestedKey\":false,\"frame\":null}],\"layout\":{\"margin\":{\"t\":43.762557077625573,\"r\":7.3059360730593621,\"b\":50.845818773908846,\"l\":37.260273972602747},\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724},\"title\":{\"text\":\"99% Confidence interval of average /<br>maths scores by race\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":17.534246575342465},\"x\":0,\"xref\":\"paper\"},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[0.40000000000000002,4.5999999999999996],\"tickmode\":\"array\",\"ticktext\":[\"Chinese\",\"Others\",\"Indian\",\"Malay\"],\"tickvals\":[1,2,3,4],\"categoryorder\":\"array\",\"categoryarray\":[\"Chinese\",\"Others\",\"Indian\",\"Malay\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.6529680365296811,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-45,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176002,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"Race\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[40.653487469404247,81.295961157116452],\"tickmode\":\"array\",\"ticktext\":[\"50\",\"60\",\"70\",\"80\"],\"tickvals\":[50,60,70,80],\"categoryorder\":\"array\",\"categoryarray\":[\"50\",\"60\",\"70\",\"80\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.6529680365296811,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176002,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"Average Scores\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":null,\"bordercolor\":null,\"borderwidth\":0,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.68949771689498}},\"hovermode\":\"closest\",\"barmode\":\"relative\",\"dragmode\":\"zoom\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"61281993d5e\":{\"x\":{},\"ymin\":{},\"ymax\":{},\"type\":\"scatter\"},\"61286a42e77\":{\"x\":{},\"y\":{},\"text\":{}}},\"cur_data\":\"61281993d5e\",\"visdat\":{\"61281993d5e\":[\"function (y) \",\"x\"],\"61286a42e77\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0,\"ctGroups\":[\"SharedData06443b99\"]},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n</div>\n<div class=\"col-xs-8\">\n<div id=\"htmlwidget-f822f25d2910eb60cc91\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-f822f25d2910eb60cc91\">{\"x\":{\"crosstalkOptions\":{\"key\":[\"1\",\"2\",\"3\",\"4\"],\"group\":\"SharedData06443b99\"},\"filter\":\"none\",\"vertical\":false,\"data\":[[\"Chinese\",\"Indian\",\"Malay\",\"Others\"],[193,12,108,9],[76.50777202072538,60.66666666666666,57.44444444444444,69.66666666666667],[15.69040284264306,23.35237318418266,21.13478478068458,10.72380529476361],[1.132357288111705,7.041005437844626,2.043176763561474,3.791437722025775]],\"container\":\"<table class=\\\"compact\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>No. of pupils<\\/th>\\n      <th>Avg Scores<\\/th>\\n      <th>Std Dev<\\/th>\\n      <th>Std Error<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":8,\"scrollX\":true,\"columnDefs\":[{\"targets\":2,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":3,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":4,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"className\":\"dt-right\",\"targets\":[1,2,3,4]},{\"orderable\":false,\"targets\":0},{\"name\":\"RACE\",\"targets\":0},{\"name\":\"n\",\"targets\":1},{\"name\":\"mean\",\"targets\":2},{\"name\":\"sd\",\"targets\":3},{\"name\":\"se\",\"targets\":4}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"lengthMenu\":[8,10,25,50,100]},\"selection\":{\"mode\":\"multiple\",\"selected\":null,\"target\":\"row\",\"selectable\":null}},\"evals\":[\"options.columnDefs.0.render\",\"options.columnDefs.1.render\",\"options.columnDefs.2.render\"],\"jsHooks\":[]}</script>\n</div>\n</div>\n</div>\n```\n:::\n:::\n\n\n## ggirafe & plotly\n\n**Step 1: Create interactive error bar for 99% CI**\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# create a new column tooltip to contain the tooltip text.\nmy_sum$tooltip <- c(paste0(\"RACE: \",\n                           my_sum$RACE,\n                           \"\\n N= \",\n                            my_sum$n,\n                           \"\\n Avg Score: \",\n                           round(my_sum$mean, digits=2)\n                           ))\n\np <- ggplot(my_sum) +\n  geom_errorbar_interactive(aes(x=reorder(RACE,-mean),\n                    ymin=mean-2.58*se,    #<<<< formula to calc 95% CI\n                    ymax=mean+ 2.58*se,\n                    tooltip=tooltip),  \n                width = 0.2,\n                colour = 'black',\n                alpha = 0.9,\n                size=0.5) +\n    geom_point(aes(x=RACE,\n                 y=mean),\n             stat = 'identity', #<<< actual points refer to mean \n             color='red', \n             size = 1.5,\n             alpha = 1) + \n  labs(title=\"99% confidence interval of maths score by race\",\n       x= \"Race\",\n       y= \"Mean\") +   \n  theme(\n    axis.title.y = element_text(hjust=1, angle=0),\n    axis.text.y = element_text(),\n    axis.text.x = element_text(angle = 0, hjust = 0.5),\n    axis.title = element_text(face = \"bold\"),\n    axis.line = element_line(linewidth = 0.2), \n    plot.title = element_text(hjust=0, face=\"bold\"),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\") ,\n    )  \n\ngirafe(ggobj = p,\n       width_svg = 8,\n       height_svg = 8*0.618)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"girafe html-widget html-fill-item\" id=\"htmlwidget-d94984fc584d90995b6f\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-d94984fc584d90995b6f\">{\"x\":{\"html\":\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' class='ggiraph-svg' role='img' id='svg_47e7091a_7127_433c_91d0_828e0e44e44b' viewBox='0 0 576 355.97'>\\n <defs id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_defs'>\\n  <clipPath id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_c1'>\\n   <rect x='0' y='0' width='576' height='355.97'/>\\n  <\\/clipPath>\\n  <clipPath id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_c2'>\\n   <rect x='51.07' y='23.18' width='519.45' height='301.29'/>\\n  <\\/clipPath>\\n <\\/defs>\\n <g id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_rootg' class='ggiraph-svg-rootg'>\\n  <g clip-path='url(#svg_47e7091a_7127_433c_91d0_828e0e44e44b_c1)'>\\n   <rect x='0' y='0' width='576' height='355.97' fill='#FFFFFF' fill-opacity='1' stroke='#FFFFFF' stroke-opacity='1' stroke-width='0.75' stroke-linejoin='round' stroke-linecap='round' class='ggiraph-svg-bg'/>\\n   <rect x='0' y='0' width='576' height='355.97' fill='#F5F5F5' fill-opacity='1' stroke='#F5F5F5' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='round'/>\\n  <\\/g>\\n  <g clip-path='url(#svg_47e7091a_7127_433c_91d0_828e0e44e44b_c2)'>\\n   <rect x='51.07' y='23.18' width='519.45' height='301.29' fill='#EBEBEB' fill-opacity='1' stroke='none'/>\\n   <polyline points='51.07,292.25 570.52,292.25' fill='none' stroke='#FFFFFF' stroke-opacity='1' stroke-width='0.53' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='51.07,218.12 570.52,218.12' fill='none' stroke='#FFFFFF' stroke-opacity='1' stroke-width='0.53' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='51.07,143.98 570.52,143.98' fill='none' stroke='#FFFFFF' stroke-opacity='1' stroke-width='0.53' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='51.07,69.85 570.52,69.85' fill='none' stroke='#FFFFFF' stroke-opacity='1' stroke-width='0.53' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='51.07,255.18 570.52,255.18' fill='none' stroke='#FFFFFF' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='51.07,181.05 570.52,181.05' fill='none' stroke='#FFFFFF' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='51.07,106.92 570.52,106.92' fill='none' stroke='#FFFFFF' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='51.07,32.78 570.52,32.78' fill='none' stroke='#FFFFFF' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='125.27,324.47 125.27,23.18' fill='none' stroke='#FFFFFF' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='248.95,324.47 248.95,23.18' fill='none' stroke='#FFFFFF' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='372.63,324.47 372.63,23.18' fill='none' stroke='#FFFFFF' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='496.31,324.47 496.31,23.18' fill='none' stroke='#FFFFFF' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_e1' points='112.91,37.02 137.64,37.02' fill='none' stroke='#000000' stroke-opacity='0.9' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt' title='RACE: Chinese&amp;lt;br/&amp;gt; N= 193&amp;lt;br/&amp;gt; Avg Score: 76.51'/>\\n   <polyline id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_e2' points='125.27,37.02 125.27,80.33' fill='none' stroke='#000000' stroke-opacity='0.9' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt' title='RACE: Chinese&amp;lt;br/&amp;gt; N= 193&amp;lt;br/&amp;gt; Avg Score: 76.51'/>\\n   <polyline id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_e3' points='112.91,80.33 137.64,80.33' fill='none' stroke='#000000' stroke-opacity='0.9' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt' title='RACE: Chinese&amp;lt;br/&amp;gt; N= 193&amp;lt;br/&amp;gt; Avg Score: 76.51'/>\\n   <polyline id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_e4' points='360.27,41.44 385.00,41.44' fill='none' stroke='#000000' stroke-opacity='0.9' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt' title='RACE: Indian&amp;lt;br/&amp;gt; N= 12&amp;lt;br/&amp;gt; Avg Score: 60.67'/>\\n   <polyline id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_e5' points='372.63,41.44 372.63,310.78' fill='none' stroke='#000000' stroke-opacity='0.9' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt' title='RACE: Indian&amp;lt;br/&amp;gt; N= 12&amp;lt;br/&amp;gt; Avg Score: 60.67'/>\\n   <polyline id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_e6' points='360.27,310.78 385.00,310.78' fill='none' stroke='#000000' stroke-opacity='0.9' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt' title='RACE: Indian&amp;lt;br/&amp;gt; N= 12&amp;lt;br/&amp;gt; Avg Score: 60.67'/>\\n   <polyline id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_e7' points='483.94,160.92 508.68,160.92' fill='none' stroke='#000000' stroke-opacity='0.9' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt' title='RACE: Malay&amp;lt;br/&amp;gt; N= 108&amp;lt;br/&amp;gt; Avg Score: 57.44'/>\\n   <polyline id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_e8' points='496.31,160.92 496.31,239.07' fill='none' stroke='#000000' stroke-opacity='0.9' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt' title='RACE: Malay&amp;lt;br/&amp;gt; N= 108&amp;lt;br/&amp;gt; Avg Score: 57.44'/>\\n   <polyline id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_e9' points='483.94,239.07 508.68,239.07' fill='none' stroke='#000000' stroke-opacity='0.9' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt' title='RACE: Malay&amp;lt;br/&amp;gt; N= 108&amp;lt;br/&amp;gt; Avg Score: 57.44'/>\\n   <polyline id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_e10' points='236.59,36.87 261.32,36.87' fill='none' stroke='#000000' stroke-opacity='0.9' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt' title='RACE: Others&amp;lt;br/&amp;gt; N= 9&amp;lt;br/&amp;gt; Avg Score: 69.67'/>\\n   <polyline id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_e11' points='248.95,36.87 248.95,181.90' fill='none' stroke='#000000' stroke-opacity='0.9' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt' title='RACE: Others&amp;lt;br/&amp;gt; N= 9&amp;lt;br/&amp;gt; Avg Score: 69.67'/>\\n   <polyline id='svg_47e7091a_7127_433c_91d0_828e0e44e44b_e12' points='236.59,181.90 261.32,181.90' fill='none' stroke='#000000' stroke-opacity='0.9' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt' title='RACE: Others&amp;lt;br/&amp;gt; N= 9&amp;lt;br/&amp;gt; Avg Score: 69.67'/>\\n   <circle cx='125.27' cy='58.67' r='1.47pt' fill='#FF0000' fill-opacity='1' stroke='#FF0000' stroke-opacity='1' stroke-width='0.71' stroke-linejoin='round' stroke-linecap='round'/>\\n   <circle cx='372.63' cy='176.11' r='1.47pt' fill='#FF0000' fill-opacity='1' stroke='#FF0000' stroke-opacity='1' stroke-width='0.71' stroke-linejoin='round' stroke-linecap='round'/>\\n   <circle cx='496.31' cy='200' r='1.47pt' fill='#FF0000' fill-opacity='1' stroke='#FF0000' stroke-opacity='1' stroke-width='0.71' stroke-linejoin='round' stroke-linecap='round'/>\\n   <circle cx='248.95' cy='109.39' r='1.47pt' fill='#FF0000' fill-opacity='1' stroke='#FF0000' stroke-opacity='1' stroke-width='0.71' stroke-linejoin='round' stroke-linecap='round'/>\\n  <\\/g>\\n  <g clip-path='url(#svg_47e7091a_7127_433c_91d0_828e0e44e44b_c1)'>\\n   <polyline points='51.07,324.47 51.07,23.18' fill='none' stroke='#000000' stroke-opacity='1' stroke-width='0.43' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <text x='36.34' y='258.33' font-size='6.6pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>50<\\/text>\\n   <text x='36.34' y='184.2' font-size='6.6pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>60<\\/text>\\n   <text x='36.34' y='110.07' font-size='6.6pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>70<\\/text>\\n   <text x='36.34' y='35.93' font-size='6.6pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>80<\\/text>\\n   <polyline points='48.33,255.18 51.07,255.18' fill='none' stroke='#333333' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='48.33,181.05 51.07,181.05' fill='none' stroke='#333333' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='48.33,106.92 51.07,106.92' fill='none' stroke='#333333' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='48.33,32.78 51.07,32.78' fill='none' stroke='#333333' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='51.07,324.47 570.52,324.47' fill='none' stroke='#000000' stroke-opacity='1' stroke-width='0.43' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='125.27,327.21 125.27,324.47' fill='none' stroke='#333333' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='248.95,327.21 248.95,324.47' fill='none' stroke='#333333' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='372.63,327.21 372.63,324.47' fill='none' stroke='#333333' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <polyline points='496.31,327.21 496.31,324.47' fill='none' stroke='#333333' stroke-opacity='1' stroke-width='1.07' stroke-linejoin='round' stroke-linecap='butt'/>\\n   <text x='109.13' y='335.7' font-size='6.6pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>Chinese<\\/text>\\n   <text x='235.74' y='335.7' font-size='6.6pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>Others<\\/text>\\n   <text x='360.64' y='335.7' font-size='6.6pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>Indian<\\/text>\\n   <text x='484.58' y='335.7' font-size='6.6pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>Malay<\\/text>\\n   <text x='297.64' y='348.17' font-size='8.25pt' font-weight='bold' font-family='Arial'>Race<\\/text>\\n   <text x='5.48' y='31.05' font-size='8.25pt' font-weight='bold' font-family='Arial'>Mean<\\/text>\\n   <text x='51.07' y='14.93' font-size='9.9pt' font-weight='bold' font-family='Arial'>99% confidence interval of maths score by race<\\/text>\\n  <\\/g>\\n <\\/g>\\n<\\/svg>\",\"js\":null,\"uid\":\"svg_47e7091a_7127_433c_91d0_828e0e44e44b\",\"ratio\":1.618122977346278,\"settings\":{\"tooltip\":{\"css\":\".tooltip_SVGID_ { padding:5px;background:black;color:white;border-radius:2px;text-align:left; ; position:absolute;pointer-events:none;z-index:999;}\",\"placement\":\"doc\",\"opacity\":0.9,\"offx\":10,\"offy\":10,\"use_cursor_pos\":true,\"use_fill\":false,\"use_stroke\":false,\"delay_over\":200,\"delay_out\":500},\"hover\":{\"css\":\".hover_data_SVGID_ { fill:orange;stroke:black;cursor:pointer; }\\ntext.hover_data_SVGID_ { stroke:none;fill:orange; }\\ncircle.hover_data_SVGID_ { fill:orange;stroke:black; }\\nline.hover_data_SVGID_, polyline.hover_data_SVGID_ { fill:none;stroke:orange; }\\nrect.hover_data_SVGID_, polygon.hover_data_SVGID_, path.hover_data_SVGID_ { fill:orange;stroke:none; }\\nimage.hover_data_SVGID_ { stroke:orange; }\",\"reactive\":true,\"nearest_distance\":null},\"hover_inv\":{\"css\":\"\"},\"hover_key\":{\"css\":\".hover_key_SVGID_ { fill:orange;stroke:black;cursor:pointer; }\\ntext.hover_key_SVGID_ { stroke:none;fill:orange; }\\ncircle.hover_key_SVGID_ { fill:orange;stroke:black; }\\nline.hover_key_SVGID_, polyline.hover_key_SVGID_ { fill:none;stroke:orange; }\\nrect.hover_key_SVGID_, polygon.hover_key_SVGID_, path.hover_key_SVGID_ { fill:orange;stroke:none; }\\nimage.hover_key_SVGID_ { stroke:orange; }\",\"reactive\":true},\"hover_theme\":{\"css\":\".hover_theme_SVGID_ { fill:orange;stroke:black;cursor:pointer; }\\ntext.hover_theme_SVGID_ { stroke:none;fill:orange; }\\ncircle.hover_theme_SVGID_ { fill:orange;stroke:black; }\\nline.hover_theme_SVGID_, polyline.hover_theme_SVGID_ { fill:none;stroke:orange; }\\nrect.hover_theme_SVGID_, polygon.hover_theme_SVGID_, path.hover_theme_SVGID_ { fill:orange;stroke:none; }\\nimage.hover_theme_SVGID_ { stroke:orange; }\",\"reactive\":true},\"select\":{\"css\":\".select_data_SVGID_ { fill:red;stroke:black;cursor:pointer; }\\ntext.select_data_SVGID_ { stroke:none;fill:red; }\\ncircle.select_data_SVGID_ { fill:red;stroke:black; }\\nline.select_data_SVGID_, polyline.select_data_SVGID_ { fill:none;stroke:red; }\\nrect.select_data_SVGID_, polygon.select_data_SVGID_, path.select_data_SVGID_ { fill:red;stroke:none; }\\nimage.select_data_SVGID_ { stroke:red; }\",\"type\":\"multiple\",\"only_shiny\":true,\"selected\":[]},\"select_inv\":{\"css\":\"\"},\"select_key\":{\"css\":\".select_key_SVGID_ { fill:red;stroke:black;cursor:pointer; }\\ntext.select_key_SVGID_ { stroke:none;fill:red; }\\ncircle.select_key_SVGID_ { fill:red;stroke:black; }\\nline.select_key_SVGID_, polyline.select_key_SVGID_ { fill:none;stroke:red; }\\nrect.select_key_SVGID_, polygon.select_key_SVGID_, path.select_key_SVGID_ { fill:red;stroke:none; }\\nimage.select_key_SVGID_ { stroke:red; }\",\"type\":\"single\",\"only_shiny\":true,\"selected\":[]},\"select_theme\":{\"css\":\".select_theme_SVGID_ { fill:red;stroke:black;cursor:pointer; }\\ntext.select_theme_SVGID_ { stroke:none;fill:red; }\\ncircle.select_theme_SVGID_ { fill:red;stroke:black; }\\nline.select_theme_SVGID_, polyline.select_theme_SVGID_ { fill:none;stroke:red; }\\nrect.select_theme_SVGID_, polygon.select_theme_SVGID_, path.select_theme_SVGID_ { fill:red;stroke:none; }\\nimage.select_theme_SVGID_ { stroke:red; }\",\"type\":\"single\",\"only_shiny\":true,\"selected\":[]},\"zoom\":{\"min\":1,\"max\":1,\"duration\":300},\"toolbar\":{\"position\":\"topright\",\"pngname\":\"diagram\",\"tooltips\":null,\"hidden\":[],\"delay_over\":200,\"delay_out\":500},\"sizing\":{\"rescale\":true,\"width\":1}}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n**Step 2: Create an interactive data table with DT**\n\n-   `%>%` operator pipes the data frame into the `mutate_if()` function, where we specify the condition `is.numeric` to select only the numeric columns. We use the tilde `~` symbol to specify the rounding function, and pass the `digits` argument to round to two decimal places. The resulting data frame `df` will have all numerical columns rounded to two decimal places.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Round all numerical columns to two decimal places\nmy_sum <- my_sum %>% \n  mutate_if(is.numeric, ~ round(., digits = 2))\n\nDT::datatable(my_sum, class='compact')\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-25bda676aa8ff903b674\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-25bda676aa8ff903b674\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\"],[\"Chinese\",\"Indian\",\"Malay\",\"Others\"],[193,12,108,9],[76.51000000000001,60.67,57.44,69.67],[15.69,23.35,21.13,10.72],[1.13,7.04,2.04,3.79],[\"RACE: Chinese\\n N= 193\\n Avg Score: 76.51\",\"RACE: Indian\\n N= 12\\n Avg Score: 60.67\",\"RACE: Malay\\n N= 108\\n Avg Score: 57.44\",\"RACE: Others\\n N= 9\\n Avg Score: 69.67\"]],\"container\":\"<table class=\\\"compact\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>RACE<\\/th>\\n      <th>n<\\/th>\\n      <th>mean<\\/th>\\n      <th>sd<\\/th>\\n      <th>se<\\/th>\\n      <th>tooltip<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[2,3,4,5]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"RACE\",\"targets\":1},{\"name\":\"n\",\"targets\":2},{\"name\":\"mean\",\"targets\":3},{\"name\":\"sd\",\"targets\":4},{\"name\":\"se\",\"targets\":5},{\"name\":\"tooltip\",\"targets\":6}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false},\"selection\":{\"mode\":\"multiple\",\"selected\":null,\"target\":\"row\",\"selectable\":null}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n**Step 3: Combining both**\n\nNext, combine graph and interactive table using [Crosstalk](https://rstudio.github.io/crosstalk/), which is an add-on to the htmlwidgets package. It extends htmlwidgets with a set of classes, functions, and conventions for implementing cross-widget interactions (currently, linked brushing and filtering).\n\nThe datatable is linked to the visualisation. Click on multiple rows to filter according.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Use highlight_key() to add a unique key to the data frame my_sum3 so that it can be linked to interactive plots later\nd <- highlight_key(my_sum) \n\n\np <- ggplot(d) +\n  geom_errorbar(aes(x=reorder(RACE,-mean),\n                    ymin=mean-2.58*se,    #<<<< formula to calc 95% CI\n                    ymax=mean+ 2.58*se),  \n                width = 0.2,\n                colour = 'black',\n                alpha = 0.9,\n                size=0.5) +\n    geom_point(aes(x=RACE,\n                 y=mean),\n             stat = 'identity', #<<< actual points refer to mean \n             color='red', \n             size = 1.5,\n             alpha = 1) + \n  labs(title=\"99% confidence interval of maths score by race\",\n       x= \"Race\",\n       y= \"Mean\") +   \n  theme(\n    axis.title.y = element_text(hjust=1, angle=0),\n    axis.text.y = element_text(),\n    axis.text.x = element_text(angle = 0, hjust = 0.5),\n    axis.title = element_text(face = \"bold\"),\n    axis.line = element_line(linewidth = 0.2), \n    plot.title = element_text(hjust=0, face=\"bold\"),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\") ,\n    )  \n\n# Convert ggplot to an interactive plotly plot using the ggplotly(), \"plotly click\" specifies that highlight should be based on click\ngg <- highlight(ggplotly(p),        \n                \"plotly_selected\")  \n\ncrosstalk::bscols(list(width = 7,gg),\n                  list(width=5,DT::datatable(d)))\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"container-fluid crosstalk-bscols\">\n<div class=\"row\">\n<div class=\"col-xs-6\">\n7\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-5a018aaa296776bc0912\" style=\"width:100%;height:400px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-5a018aaa296776bc0912\">{\"x\":{\"data\":[{\"x\":[1,3,4,2],\"y\":[76.510000000000005,60.670000000000002,57.439999999999998,69.670000000000002],\"text\":[\"reorder(RACE, -mean): Chinese<br />mean - 2.58 * se: 73.5946<br />mean + 2.58 * se: 79.4254\",\"reorder(RACE, -mean): Indian<br />mean - 2.58 * se: 42.5068<br />mean + 2.58 * se: 78.8332\",\"reorder(RACE, -mean): Malay<br />mean - 2.58 * se: 52.1768<br />mean + 2.58 * se: 62.7032\",\"reorder(RACE, -mean): Others<br />mean - 2.58 * se: 59.8918<br />mean + 2.58 * se: 79.4482\"],\"key\":[\"1\",\"2\",\"3\",\"4\"],\"type\":\"scatter\",\"mode\":\"lines\",\"opacity\":0.90000000000000002,\"line\":{\"color\":\"transparent\"},\"error_y\":{\"array\":[2.9154000000000053,18.163200000000003,5.2631999999999977,9.7781999999999982],\"arrayminus\":[2.9154000000000053,18.163200000000003,5.2631999999999977,9.7781999999999982],\"type\":\"data\",\"width\":21.333333333333353,\"symmetric\":false,\"color\":\"rgba(0,0,0,1)\"},\"set\":\"SharedData8a129951\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"_isNestedKey\":false,\"frame\":null},{\"x\":[1,3,4,2],\"y\":[76.510000000000005,60.670000000000002,57.439999999999998,69.670000000000002],\"text\":[\"RACE: Chinese<br />mean: 76.51\",\"RACE: Indian<br />mean: 60.67\",\"RACE: Malay<br />mean: 57.44\",\"RACE: Others<br />mean: 69.67\"],\"key\":[\"1\",\"2\",\"3\",\"4\"],\"type\":\"scatter\",\"mode\":\"markers\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(255,0,0,1)\",\"opacity\":1,\"size\":5.6692913385826778,\"symbol\":\"circle\",\"line\":{\"width\":1.8897637795275593,\"color\":\"rgba(255,0,0,1)\"}},\"hoveron\":\"points\",\"set\":\"SharedData8a129951\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"_isNestedKey\":false,\"frame\":null}],\"layout\":{\"margin\":{\"t\":43.762557077625573,\"r\":7.3059360730593621,\"b\":40.182648401826491,\"l\":51.872146118721474},\"plot_bgcolor\":\"rgba(235,235,235,1)\",\"paper_bgcolor\":\"rgba(245,245,245,1)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724},\"title\":{\"text\":\"<b> 99% confidence interval of maths score by race <\\/b>\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":17.534246575342465},\"x\":0,\"xref\":\"paper\"},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[0.40000000000000002,4.5999999999999996],\"tickmode\":\"array\",\"ticktext\":[\"Chinese\",\"Others\",\"Indian\",\"Malay\"],\"tickvals\":[1,2,3,4],\"categoryorder\":\"array\",\"categoryarray\":[\"Chinese\",\"Others\",\"Indian\",\"Malay\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(51,51,51,1)\",\"ticklen\":3.6529680365296811,\"tickwidth\":0.66417600664176002,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":true,\"linecolor\":\"rgba(0,0,0,1)\",\"linewidth\":0.265670402656704,\"showgrid\":true,\"gridcolor\":\"rgba(255,255,255,1)\",\"gridwidth\":0.66417600664176002,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"<b> Race <\\/b>\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[40.659729999999996,81.295270000000002],\"tickmode\":\"array\",\"ticktext\":[\"50\",\"60\",\"70\",\"80\"],\"tickvals\":[50,60,70,80],\"categoryorder\":\"array\",\"categoryarray\":[\"50\",\"60\",\"70\",\"80\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(51,51,51,1)\",\"ticklen\":3.6529680365296811,\"tickwidth\":0.66417600664176002,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":true,\"linecolor\":\"rgba(0,0,0,1)\",\"linewidth\":0.26567040265670405,\"showgrid\":true,\"gridcolor\":\"rgba(255,255,255,1)\",\"gridwidth\":0.66417600664176002,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"<b> Mean <\\/b>\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":\"rgba(255,255,255,1)\",\"bordercolor\":\"transparent\",\"borderwidth\":1.8897637795275593,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.68949771689498}},\"hovermode\":\"closest\",\"barmode\":\"relative\",\"dragmode\":\"select\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"61283a2f5378\":{\"x\":{},\"ymin\":{},\"ymax\":{},\"type\":\"scatter\"},\"61284b0e522a\":{\"x\":{},\"y\":{}}},\"cur_data\":\"61283a2f5378\",\"visdat\":{\"61283a2f5378\":[\"function (y) \",\"x\"],\"61284b0e522a\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_selected\",\"off\":\"plotly_deselect\",\"persistent\":false,\"dynamic\":false,\"color\":null,\"selectize\":false,\"defaultValues\":null,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0,\"ctGroups\":[\"SharedData8a129951\"]},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n</div>\n<div class=\"col-xs-6\">\n5\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-5e678319b0089e0fc3d5\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-5e678319b0089e0fc3d5\">{\"x\":{\"crosstalkOptions\":{\"key\":[\"1\",\"2\",\"3\",\"4\"],\"group\":\"SharedData8a129951\"},\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\"],[\"Chinese\",\"Indian\",\"Malay\",\"Others\"],[193,12,108,9],[76.51000000000001,60.67,57.44,69.67],[15.69,23.35,21.13,10.72],[1.13,7.04,2.04,3.79],[\"RACE: Chinese\\n N= 193\\n Avg Score: 76.51\",\"RACE: Indian\\n N= 12\\n Avg Score: 60.67\",\"RACE: Malay\\n N= 108\\n Avg Score: 57.44\",\"RACE: Others\\n N= 9\\n Avg Score: 69.67\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>RACE<\\/th>\\n      <th>n<\\/th>\\n      <th>mean<\\/th>\\n      <th>sd<\\/th>\\n      <th>se<\\/th>\\n      <th>tooltip<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[2,3,4,5]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"RACE\",\"targets\":1},{\"name\":\"n\",\"targets\":2},{\"name\":\"mean\",\"targets\":3},{\"name\":\"sd\",\"targets\":4},{\"name\":\"se\",\"targets\":5},{\"name\":\"tooltip\",\"targets\":6}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false},\"selection\":{\"mode\":\"multiple\",\"selected\":null,\"target\":\"row\",\"selectable\":null}},\"evals\":[],\"jsHooks\":[]}</script>\n</div>\n</div>\n</div>\n```\n:::\n:::\n\n:::\n\n# 4 Visualising Uncertainty: **ggdist** package\n\n-   [**ggdist**](https://mjskay.github.io/ggdist/) is an R package that provides a flexible set of ggplot2 geoms and stats designed especially for **visualising** distributions and uncertainty.\n\n-   It is designed for both frequentist and Bayesian uncertainty visualization, taking the view that uncertainty visualization can be unified through the perspective of distribution visualization:\n\n    -   for frequentist models, one visualises confidence distributions or bootstrap distributions (see vignette(\"freq-uncertainty-vis\"));\n\n    -   for Bayesian models, one visualises probability distributions (see the tidybayes package, which builds on top of ggdist).\n\n## 4.1 Visualizing the uncertainty of point estimates\n\nIn the code chunk below, [`stat_pointinterval()`](https://mjskay.github.io/ggdist/reference/stat_pointinterval.html) of **ggdist** is used to build a visual for displaying distribution of maths scores by race.\n\n`stat_pointinterval` means points and multiple intervals. The default confidence interval us 95%. To change the level to 99%, add **conf.level = 0.99** to `stat_pointinterval` function.\n\nTake note that the default .width values are set to c(0.66, 0.95) confidence intervals.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nexam %>% \n  ggplot(aes(x=RACE,       #<< plot the base layer\n             y=MATHS)) +\n  stat_pointinterval() +   #<< .width=c(0.66,0.95)\n  labs(\n    title='Visualising confidence intervals of mean math score',\n    subtitle = \"Mean Point + Multiple-interval plot 66% and 95%\",\n       x= \"Race\",\n       y= \"Math\") +  \n  theme(\n    axis.title.y = element_text(hjust=1, angle=0),\n    axis.text.y = element_text(),\n    axis.text.x = element_text(angle = 0, hjust = 0.5),\n    axis.title = element_text(),\n    axis.line = element_line(linewidth = 0.2), \n    plot.title = element_text(hjust=0, face=\"bold\"),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\") ,\n    )\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex04c_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nSome of the arguments:\n\n-   `.width`: For intervals, the interval width as a numeric value in `[0, 1]`. For slabs, the width of the smallest interval containing that value of the slab.\n\n-   `point_interval`: This function determines the point summary (typically mean, median, or mode) and interval type (quantile interval, `qi`; highest-density interval, `hdi`; or highest-density continuous interval, `hdci`)\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nexam %>%\n      ggplot(aes(x = RACE, y = MATHS)) +\n      stat_pointinterval(\n        .width = 0.95,       #<< \n        .point = median,     #<< \n        .interval = qi) +    #<< \n  labs(\n    title='Visualising confidence intervals of mean math score',\n    subtitle = \"Mean Point + Multiple-interval plot, 95% only\",\n       x= \"Race\",\n       y= \"Math\") +  \n  theme(\n    axis.title.y = element_text(hjust=1, angle=0),\n    axis.text.y = element_text(),\n    axis.text.x = element_text(angle = 0, hjust = 0.5),\n    axis.title = element_text(),\n    axis.line = element_line(linewidth = 0.2), \n    plot.title = element_text(hjust=0, face=\"bold\"),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\") ,\n    )\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex04c_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nexam %>%\n  ggplot(aes(x = RACE, y = MATHS)) +\n  \n  #Using stat_pointinterval to plot the points and intervals\n  stat_pointinterval(\n    .width = c(0.95,0.99), #<<\n  .point = median,\n  .interval = qi,\n  aes(interval_color=stat(level)),\n  show.legend = FALSE) +\n  \n  #Defining the color of the intervals \n  scale_color_manual(\n    values = c(\"#73b2c4\", \"#f27279\"),\n    aesthetics = \"interval_color\") +\n  \n  #Title, subtitle, and caption\n    labs(\n    title='Visualising confidence intervals of mean math score',\n    subtitle = \"Mean Point + Multiple-interval plot, 95% and 99%\",\n       x= \"Race\",\n       y= \"Math\") +  \n  \n  \n  theme(\n    axis.title.y = element_text(hjust=1, angle=0),\n    axis.text.y = element_text(),\n    axis.text.x = element_text(angle = 0, hjust = 0.5),\n    axis.title = element_text(),\n    axis.line = element_line(linewidth = 0.2), \n    plot.title = element_text(hjust=0, face=\"bold\"),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\") ,\n    )  \n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex04c_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n::: {.nursebox .nurse data-latex=\"nurse\"}\n-   **`stat(level)`** calculates the confidence interval limits based on the specified **`conf.level`** argument\n-   **`interval_color`** maps the calculated interval color to the **`interval_color`** argument.\n:::\n\n## 4.2 Using `stat_gradientinterval()`\n\nIn the code chunk below, [`stat_gradientinterval()`](https://mjskay.github.io/ggdist/reference/stat_gradientinterval.html) of **ggdist** is used to build a visual for displaying distribution of maths scores by race.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nexam %>%\n  ggplot(aes(x = RACE, \n             y = MATHS)) +\n  stat_gradientinterval(   \n    fill = \"#d18a7d\",      \n    show.legend = TRUE     \n  ) +                        \n  labs(\n    title = \"Visualising confidence intervals of mean math score\",\n    subtitle = \"Gradient + interval plot\")+\n  theme(\n    axis.title.y = element_text(hjust=1, angle=0),\n    axis.text.y = element_text(),\n    axis.text.x = element_text(angle = 0, hjust = 0.5),\n    axis.title = element_text(),\n    axis.line = element_line(linewidth = 0.2), \n    plot.title = element_text(hjust=0, face=\"bold\"),\n    legend.background = element_rect(colour = \"#f5f5f5\", fill = \"#f5f5f5\"),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\") ,\n    )  \n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex04c_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n# 5 Visualising Uncertainty with Hypothetical Outcome Plots (HOPs)\n\n**What are HOPs?**\n\nRather than showing a continuous probability distribution, Hypothetical Outcome Plots (or HOPs) ***visualize a set of draws from a distribution, where each draw is shown as a new plot in either a small multiples or animated form***.\n\n**Explanation of the code below:**\\\nThe code creates a ggplot object to visualize the distribution of `MATHS` scores for different races in the `exam` dataset using the `geom_point()` and `geom_hpline()` functions from `ggplot2`.\n\nSpecifically, it is creating a scatterplot (`geom_point()`) of `MATHS` scores against `RACE` with some jitter (`position_jitter()`) added to the points to avoid overplotting. The `factor()` function is used to convert the `RACE` variable to a categorical variable.\n\nAdditionally, a horizontal line (`geom_hpline()`) is added to the plot to represent the median `MATHS` score for each race, calculated using `sampler()` function with 25 samples drawn from the original dataset for each race. The line is colored in `#D55E00`.\n\nThe `transition_states()` function is used to create an animation by specifying the `.draw` column as the states for the animation. The animation has 3 states (1, 2, 3) and will animate the plot with a transition between each state.\n\nFinally, the `theme_bw()` function is used to set the theme of the plot to a black and white color scheme.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nhop <-\n  ggplot(data = exam, \n       (aes(x = factor(RACE), \n            y = MATHS))) +\n  geom_point(position = position_jitter(\n    height = 0.3, \n    width = 0.05), \n    linewidth = 0.4, \n    color = \"#a6a6a6\", \n    alpha = 1/2) +\n  \n  geom_hpline(data = sampler(25, \n                             group = RACE), \n              height = 0.6, \n              color = \"#f5347f\") +\n  theme_bw() +\n  labs(\n    y = \"Math\",\n    x = \"Race\")+\n    theme(\n    panel.background = element_rect(fill=\"#f5f5f5\", color=\"#f5f5f5\"),\n    axis.title.y = element_text(hjust=1, angle=0),\n    axis.text.x = element_text(angle = 0, hjust = 0.5),\n    plot.title = element_text(hjust=0, face=\"bold\"),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\") ,\n    )  +\n  \n  # `.draw` is a generated column indicating the sample draw\n  transition_states(.draw, 1, 3)\n\nhop\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex04c_files/figure-html/unnamed-chunk-16-1.gif)\n:::\n:::\n\n\n# 6 Reference\n\n-   Kam, T.S. (2023). [Visualising Uncertainty](https://r4va.netlify.app/chap11).",
    "supporting": [
      "Hands-on_Ex04c_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\r\n<script src=\"../../site_libs/plotly-binding-4.10.4/plotly.js\"></script>\r\n<script src=\"../../site_libs/typedarray-0.1/typedarray.min.js\"></script>\r\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\r\n<link href=\"../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\r\n<link href=\"../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\r\n<link href=\"../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/datatables-binding-0.31/datatables.js\"></script>\r\n<link href=\"../../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\r\n<link href=\"../../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\r\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n<link href=\"../../site_libs/bootstrap-grid-3.4.1/bootstrap-grid.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/d3-bundle-5.16.0/d3-bundle.min.js\"></script>\r\n<script src=\"../../site_libs/d3-lasso-0.0.5/d3-lasso.min.js\"></script>\r\n<script src=\"../../site_libs/save-svg-as-png-1.4.17/save-svg-as-png.min.js\"></script>\r\n<script src=\"../../site_libs/flatbush-4.0.0/flatbush.min.js\"></script>\r\n<link href=\"../../site_libs/ggiraphjs-0.4.6/ggiraphjs.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/ggiraphjs-0.4.6/ggiraphjs.min.js\"></script>\r\n<script src=\"../../site_libs/girafe-binding-0.8.8/girafe.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}