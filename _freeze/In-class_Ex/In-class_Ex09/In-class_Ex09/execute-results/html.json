{
  "hash": "26b8e757552a38ab91b2ab4b8dcc2e59",
  "result": {
    "markdown": "---\ntitle: \"In-class Exercise 9: Modelling, Visualising and Analysing Network Data with R\"\ndate: \"16 Mar 2024\"\ndate-modified: \"last-modified\"\neditor: visual\ntoc-depth: 4\nexecute:\n  freeze: true #never re-render during project render\n  echo: true #if false, displays charts without codes\n  eval: true #if false, displays codes without charts\n  warning: false #dont display if there are any warnings\nformat: \n  html:\n    code-fold: false\n    code-overflow: scroll\n    code-summary: \"Show the code\"\n    code-line-numbers: false\n---\n\n\n# 1 Getting Started\n\n::: panel-tabset\n## Installing and Launching R Packages\n\n-   Network data modelling and visualisation packages: **igraph**, **tidygraph**, **ggraph** and **visNetwork**. **igraph** is already part of **tidygraph**.\n-   Data/time wrangling: **tidyverse**, **clock**, **lubridate**\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidygraph, ggraph, \n               visNetwork, lubridate, clock,\n               tidyverse, graphlayouts,\n               knitr)\n```\n:::\n\n\n## The Data\n\n-   **Edges** data: *GAStech-email_edges.csv* which consists of two weeks of 9063 emails correspondances between 55 employees.\n-   **Nodes** data: *GAStech_email_nodes.csv* which consist of the names, department and title of the 55 employees.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_nodes <- read_csv(\"data/GAStech_email_node.csv\")\nGAStech_edges <- read_csv(\"data/GAStech_email_edge-v2.csv\")\n```\n:::\n\n## Checking the Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(GAStech_edges)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 9,063\nColumns: 8\n$ source      <dbl> 43, 43, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 26, 26, 26…\n$ target      <dbl> 41, 40, 51, 52, 53, 45, 44, 46, 48, 49, 47, 54, 27, 28, 29…\n$ SentDate    <chr> \"6/1/2014\", \"6/1/2014\", \"6/1/2014\", \"6/1/2014\", \"6/1/2014\"…\n$ SentTime    <time> 08:39:00, 08:39:00, 08:58:00, 08:58:00, 08:58:00, 08:58:0…\n$ Subject     <chr> \"GT-SeismicProcessorPro Bug Report\", \"GT-SeismicProcessorP…\n$ MainSubject <chr> \"Work related\", \"Work related\", \"Work related\", \"Work rela…\n$ sourceLabel <chr> \"Sven.Flecha\", \"Sven.Flecha\", \"Kanon.Herrero\", \"Kanon.Herr…\n$ targetLabel <chr> \"Isak.Baza\", \"Lucas.Alcazar\", \"Felix.Resumir\", \"Hideki.Coc…\n```\n:::\n:::\n\n\n:::\n\n# 2 Data Manipulation\n\n## 2.1 Converting Data Types\n\nSentDate is in character field. `dmy()` converts this variable into the appropriate date format. `wday()` helps extracts the day, where `label=TRUE` and `abbr=FALSE` provides abbreviated day names.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_edges <- GAStech_edges %>%\n  mutate(SendDate = dmy(SentDate)) %>%\n  mutate(Weekday = wday(SentDate,\n                        label = TRUE,\n                        abbr = FALSE))\n```\n:::\n\n\nChecking the changes: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(GAStech_edges)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 9,063\nColumns: 10\n$ source      <dbl> 43, 43, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 26, 26, 26…\n$ target      <dbl> 41, 40, 51, 52, 53, 45, 44, 46, 48, 49, 47, 54, 27, 28, 29…\n$ SentDate    <chr> \"6/1/2014\", \"6/1/2014\", \"6/1/2014\", \"6/1/2014\", \"6/1/2014\"…\n$ SentTime    <time> 08:39:00, 08:39:00, 08:58:00, 08:58:00, 08:58:00, 08:58:0…\n$ Subject     <chr> \"GT-SeismicProcessorPro Bug Report\", \"GT-SeismicProcessorP…\n$ MainSubject <chr> \"Work related\", \"Work related\", \"Work related\", \"Work rela…\n$ sourceLabel <chr> \"Sven.Flecha\", \"Sven.Flecha\", \"Kanon.Herrero\", \"Kanon.Herr…\n$ targetLabel <chr> \"Isak.Baza\", \"Lucas.Alcazar\", \"Felix.Resumir\", \"Hideki.Coc…\n$ SendDate    <date> 2014-01-06, 2014-01-06, 2014-01-06, 2014-01-06, 2014-01-0…\n$ Weekday     <ord> Friday, Friday, Friday, Friday, Friday, Friday, Friday, Fr…\n```\n:::\n:::\n\n## 2.2 Relevant Subset\n\n`filter()` to select only work-related emails, removes where source = target (ie emailing yourself!), and where frequency of communication is >1.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_edges_aggregated <- GAStech_edges %>%\n  filter(MainSubject == \"Work related\") %>% \n  group_by(source, target, Weekday) %>%\n    summarise(Weight = n()) %>%\n  filter(source!=target) %>%\n  filter(Weight > 1) %>%\n  ungroup()\n```\n:::\n\n# 3 Preparing Network Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_graph<- tbl_graph(nodes=GAStech_nodes,\n                          edges = GAStech_edges_aggregated,\n                          directed = TRUE)\n```\n:::\n\n\nCheck that the observations and node counts reconcile to the source files.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_graph\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tbl_graph: 54 nodes and 1372 edges\n#\n# A directed multigraph with 1 component\n#\n# Node Data: 54 × 4 (active)\n      id label               Department     Title                               \n   <dbl> <chr>               <chr>          <chr>                               \n 1     1 Mat.Bramar          Administration Assistant to CEO                    \n 2     2 Anda.Ribera         Administration Assistant to CFO                    \n 3     3 Rachel.Pantanal     Administration Assistant to CIO                    \n 4     4 Linda.Lagos         Administration Assistant to COO                    \n 5     5 Ruscella.Mies.Haber Administration Assistant to Engineering Group Mana…\n 6     6 Carla.Forluniau     Administration Assistant to IT Group Manager       \n 7     7 Cornelia.Lais       Administration Assistant to Security Group Manager \n 8    44 Kanon.Herrero       Security       Badging Office                      \n 9    45 Varja.Lagos         Security       Badging Office                      \n10    46 Stenig.Fusil        Security       Building Control                    \n# ℹ 44 more rows\n#\n# Edge Data: 1,372 × 4\n   from    to Weekday Weight\n  <int> <int> <ord>    <int>\n1     1     2 Sunday       5\n2     1     2 Monday       2\n3     1     2 Tuesday      3\n# ℹ 1,369 more rows\n```\n:::\n:::\n\n\n# 4 Visualising Network Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggraph(GAStech_graph) +  #<<< GAStech_graph is a tbl_graph object\n  geom_edge_link0(edge_colour = \"#c7c8cc\", #<< global aesthetics\n                  ) +\n  geom_node_point(shape = 21,\n                  color = \"black\",\n                  stroke = 1) +\n  theme(legend.position = \"bottom\",\n        legend.background = element_rect(fill=\"#f5f5f5\"),\n        plot.background = element_rect(fill=\"#f5f5f5\"),\n        panel.background = element_rect(fill=\"#f5f5f5\"))\n```\n\n::: {.cell-output-display}\n![](In-class_Ex09_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n:::panel-tabset\n\n## `add_layout_()` = Gem\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng <- ggraph(GAStech_graph, \n            layout='gem') +\n  geom_edge_link(edge_colour = \"#c7c8cc\") + \n  geom_node_point(aes())\n\ng + \n  theme_graph() +\n     theme(legend.position = \"none\",\n        legend.background = element_rect(fill=\"#f5f5f5\", color = \"#f5f5f5\"),\n        plot.background = element_rect(fill=\"#f5f5f5\", color =\"#f5f5f5\"),\n        panel.background = element_rect(fill=\"#f5f5f5\", color =\"#f5f5f5\"))\n```\n\n::: {.cell-output-display}\n![](In-class_Ex09_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n## Nicely with coloured nodes\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng <- ggraph(GAStech_graph, \n            layout='nicely') + \n  geom_edge_link(edge_colour = \"#c7c8cc\") + \n  geom_node_point(aes(colour=Department), \n                      size =3)\n\ng + \n  theme_graph() +\n  theme(legend.position = \"bottom\",\n        legend.background = element_rect(fill=\"#f5f5f5\", color = \"#f5f5f5\"),\n        plot.background = element_rect(fill=\"#f5f5f5\", color =\"#f5f5f5\"),\n        panel.background = element_rect(fill=\"#f5f5f5\", color =\"#f5f5f5\"))  \n```\n\n::: {.cell-output-display}\n![](In-class_Ex09_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n## Introducing aesthetics for edge links\n\n`scale_edge_width` to introduce range of width.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng <- ggraph(GAStech_graph, \n            layout='nicely') + \n  geom_edge_link(aes(width=Weight), \n                     alpha= 0.1) +  #<< thickness by weight and change alpha\n  scale_edge_width(range = c(0.1, 5)) +  #<< control max size of edge , else my plot is ugly\n  geom_node_point(aes(colour=Department), \n                      size =3)\n\ng + \n  theme_graph() +\n  theme(legend.position = \"right\",\n        legend.background = element_rect(fill=\"#f5f5f5\", color = \"#f5f5f5\"),\n        plot.background = element_rect(fill=\"#f5f5f5\", color =\"#f5f5f5\"),\n        panel.background = element_rect(fill=\"#f5f5f5\", color =\"#f5f5f5\"))  \n```\n\n::: {.cell-output-display}\n![](In-class_Ex09_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n## Creating Facets\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset_graph_style()   #<< using this command provide plot settings for next few plots\n\ng <- ggraph(GAStech_graph, \n            layout = \"nicely\") + \n  geom_edge_link(aes(width=Weight), \n                 alpha=0.2) +\n  scale_edge_width(range = c(0.1, 5)) +\n  geom_node_point(aes(colour = Department), \n                  size = 2)\n\ng + \n  facet_edges(~Weekday) +\n   theme(legend.position = \"right\",\n        legend.background = element_rect(fill=\"#f5f5f5\", color = \"#f5f5f5\"),\n        plot.background = element_rect(fill=\"#f5f5f5\", color =\"#f5f5f5\"),\n        panel.background = element_rect(fill=\"#f5f5f5\", color =\"#f5f5f5\")) \n```\n\n::: {.cell-output-display}\n![](In-class_Ex09_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n:::\n\n",
    "supporting": [
      "In-class_Ex09_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}